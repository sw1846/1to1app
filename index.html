<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1to1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - PlaceOn</title>
    
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, "Helvetica Neue", "Roboto", sans-serif;
            background-color: #1e1e1e;
            color: #f0f0f0;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
        }

        /* ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ */
        .setup-wizard {
            max-width: 800px;
            margin: 50px auto;
            background: #2a2a2a;
            border-radius: 8px;
            padding: 40px;
            border: 1px solid #3a3a3a;
        }

        .setup-step {
            display: none;
        }

        .setup-step.active {
            display: block;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .setup-header h1 {
            font-size: 32px;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .setup-header p {
            color: #aaaaaa;
            font-size: 16px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            gap: 20px;
        }

        .step-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            border: 2px solid #444444;
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: #4c8bf5;
            border-color: #4c8bf5;
            color: white;
        }

        .step-dot.completed {
            background: #34a853;
            border-color: #34a853;
            color: white;
        }

        .setup-content {
            margin-bottom: 40px;
        }

        .setup-content h2 {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 20px;
        }

        .setup-content p {
            color: #aaaaaa;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            overflow-x: auto;
            position: relative;
        }

        .code-block code {
            color: #f0f0f0;
            font-size: 14px;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4c8bf5;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-button:hover {
            background: #5a96f7;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: #2a2a2a;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
        }

        h1 {
            font-size: 26px;
            color: #f0f0f0;
            font-weight: 300;
            margin: 0;
            letter-spacing: 0.5px;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* ãƒœã‚¿ãƒ³ */
        button {
            padding: 10px 18px;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 400;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #333333;
            color: #f0f0f0;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        button:hover {
            border-color: #4c8bf5;
            box-shadow: 0 0 0 1px #4c8bf5;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #4c8bf5;
            color: white;
            border-color: #4c8bf5;
        }

        .btn-primary:hover {
            background: #5a96f7;
            box-shadow: 0 0 10px rgba(76, 139, 245, 0.3);
        }

        .btn-secondary {
            background: #333333;
            color: #f0f0f0;
            border: 1px solid #444444;
        }

        .btn-secondary:hover {
            background: #3a3a3a;
            border-color: #4c8bf5;
        }

        .btn-google {
            background: white;
            color: #3c4043;
            border: 1px solid #dadce0;
            font-weight: 500;
        }

        .btn-google:hover {
            background: #f8f9fa;
            border-color: #dadce0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background: #d93025;
            color: white;
            border-color: #d93025;
        }

        .btn-danger:hover {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(217, 48, 37, 0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã‚’å¸¸æ™‚è¡¨ç¤º */
        .search-bar {
            background: #2a2a2a;
            padding: 20px 24px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #3a3a3a;
        }

        /* è¡¨ç¤ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .view-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* ä¸¦ã³æ›¿ãˆã¨ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚’æ¨ªä¸¦ã³ã« */
        .view-sort-wrapper {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«æ™‚ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰èª¬æ˜æ–‡ç°¡ç•¥åŒ– */
        @media (max-width: 768px) {
            .upload-hint {
                display: none;
            }
        }

        /* ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .meeting-card {
            background: #333333;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .meeting-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #444444;
        }

        .meeting-card-date {
            font-size: 16px;
            font-weight: 500;
            color: #4c8bf5;
        }

        .meeting-card-actions {
            display: flex;
            gap: 8px;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’å³å¯„ã› */
        .meeting-tasks {
            margin-left: 20px;
            padding: 12px;
            background: #2a2a2a;
            border-radius: 6px;
            border-left: 3px solid #4c8bf5;
        }

        /* ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
        .contact-list-item a,
        .contact-card a {
            pointer-events: auto;
            z-index: 10;
            position: relative;
        }

        /* å¼·ã¿ãƒ»çµŒæ­´ã®æŠ˜ã‚ŠãŸãŸã¿ */
        .collapsible-content {
            position: relative;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: calc(1.6em * 7);
            overflow: hidden;
        }

        .toggle-link {
            color: #4c8bf5;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            display: inline-block;
        }

        .toggle-link:hover {
            opacity: 0.8;
        }

        /* æ–°è¦é€£çµ¡å…ˆã§ã®åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .first-meeting-new {
            background: #2d2d2d;
            border: 1px solid #3d3d3d;
        }

        /* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
        .search-filters {
            background: #2a2a2a;
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px solid #3a3a3a;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .search-header h3 {
            font-weight: 300;
            font-size: 18px;
            color: #f0f0f0;
        }

        .sort-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sort-controls label {
            font-size: 14px;
            color: #aaaaaa;
            margin: 0;
        }

        .sort-controls select {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #444444;
            background: #333333;
            color: #f0f0f0;
        }

        .filter-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group.search-group {
            flex: 2;
            min-width: 300px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 400;
            font-size: 14px;
            color: #aaaaaa;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #444444;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #333333;
            color: #f0f0f0;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4c8bf5;
            box-shadow: 0 0 0 1px #4c8bf5;
        }

        input::placeholder {
            color: #666666;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* é€£çµ¡å…ˆã‚°ãƒªãƒƒãƒ‰ */
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .contact-grid {
                grid-template-columns: 1fr;
            }
        }

        .contact-card {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #3a3a3a;
        }

        .contact-card:hover {
            border-color: #4c8bf5;
            box-shadow: 0 0 20px rgba(76, 139, 245, 0.1);
        }

        .contact-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #333333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            overflow: hidden;
            font-weight: 300;
            color: #aaaaaa;
            border: 1px solid #444444;
        }

        .contact-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .contact-name {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 8px;
            color: #f0f0f0;
        }

        .contact-info {
            font-size: 14px;
            color: #aaaaaa;
            margin-bottom: 4px;
        }

        .last-meeting-info {
            font-size: 13px;
            color: #4c8bf5;
            margin-top: 8px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .tag {
            background: #333333;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            color: #aaaaaa;
            font-weight: 400;
            border: 1px solid #444444;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: #2a2a2a;
            margin: 50px auto;
            max-width: 800px;
            border-radius: 8px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #3a3a3a;
        }

        @media (max-width: 768px) {
            .modal-content {
                margin: 20px;
                max-height: calc(100vh - 40px);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-weight: 300;
            color: #f0f0f0;
        }

        .modal-body {
            padding: 20px;
        }

        .close-modal {
            font-size: 24px;
            cursor: pointer;
            color: #aaaaaa;
            transition: color 0.2s ease;
        }

        .close-modal:hover {
            color: #f0f0f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
        .file-drop-zone {
            border: 2px dashed #444444;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #333333;
            color: #aaaaaa;
        }

        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: #4c8bf5;
            background: #2a2a2a;
            color: #f0f0f0;
        }

        .file-list {
            margin-top: 10px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #333333;
            border-radius: 4px;
            margin-bottom: 5px;
            border: 1px solid #444444;
        }

        .file-item-actions {
            display: flex;
            gap: 5px;
        }

        /* ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */
        .meeting-timeline {
            margin-top: 30px;
        }

        .meeting-item {
            border-left: 3px solid #4c8bf5;
            padding-left: 20px;
            margin-bottom: 30px;
            position: relative;
        }

        .meeting-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4c8bf5;
            border: 2px solid #2a2a2a;
        }

        .meeting-date {
            font-weight: 400;
            color: #4c8bf5;
            margin-bottom: 10px;
        }

        /* Markdown ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .markdown {
            font-family: 'system-ui', sans-serif;
            color: #f0f0f0;
            background-color: transparent;
            line-height: 1.6;
            font-size: 15px;
        }

        .markdown h1 {
            font-size: 1.8em;
            font-weight: bold;
            margin: 1em 0 0.5em;
            border-bottom: 1px solid #444;
            padding-bottom: 0.3em;
        }

        .markdown h2 {
            font-size: 1.4em;
            font-weight: bold;
            margin: 0.8em 0 0.4em;
            color: #e0e0e0;
        }

        .markdown h3 {
            font-size: 1.2em;
            font-weight: bold;
            margin: 0.6em 0 0.3em;
            color: #cccccc;
        }

        .markdown p {
            margin: 0.5em 0;
        }

        .markdown ul, .markdown ol {
            padding-left: 1.6em;
            margin: 0.5em 0;
        }

        .markdown li {
            margin-bottom: 0.4em;
        }

        .markdown strong {
            font-weight: bold;
            color: #ffffff;
        }

        .markdown a {
            color: #4c8bf5;
            text-decoration: underline;
        }

        .markdown code {
            background-color: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            color: #f9f9f9;
        }

        .markdown pre {
            background-color: #333;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0.5em 0;
        }

        .markdown pre code {
            background-color: transparent;
            padding: 0;
            font-size: 0.9em;
        }

        .markdown blockquote {
            border-left: 3px solid #4c8bf5;
            padding-left: 1em;
            margin: 0.5em 0;
            color: #cccccc;
        }

        .markdown-content {
            line-height: 1.6;
            overflow: hidden;
            color: #f0f0f0;
        }

        .markdown-content.truncated {
            max-height: calc(1.6em * 7);
        }

        /* éå»ã®çµŒæ­´æŠ˜ã‚ŠãŸãŸã¿ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .career-history-content {
            position: relative;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .career-history-content.collapsed {
            max-height: calc(1.6em * 7); /* 7è¡Œåˆ†ã®é«˜ã• */
        }
        
        .career-history-toggle {
            color: #4c8bf5;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            display: inline-block;
        }
        
        .career-history-toggle:hover {
            opacity: 0.8;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .task-list {
            list-style: none;
            padding-left: 0;
            margin: 10px 0;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            padding: 8px;
            background: #333333;
            border-radius: 4px;
            border: 1px solid #444444;
        }

        .task-item.completed {
            opacity: 0.6;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #888888;
        }

        .task-checkbox {
            margin-right: 10px;
            margin-top: 2px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .task-text {
            flex: 1;
            line-height: 1.5;
        }

        .task-text.editing {
            background: #444444;
            padding: 4px 8px;
            border-radius: 4px;
            outline: none;
            display: inline-block;
            min-width: 200px;
        }

        .task-due {
            font-size: 12px;
            color: #aaaaaa;
            margin-left: 10px;
        }

        .task-due.overdue {
            color: #d93025;
        }

        /* ã‚¿ã‚¹ã‚¯æœŸé™å…¥åŠ›ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .task-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .task-input-row input[type="text"] {
            flex: 1;
        }
        
        .task-input-row input[type="datetime-local"] {
            width: auto;
            min-width: 200px;
        }
        
        .btn-add-task {
            margin-top: 10px;
        }

        /* ãã®ä»– */
        .read-more {
            color: #4c8bf5;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            transition: opacity 0.2s ease;
        }

        .read-more:hover {
            opacity: 0.8;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4c8bf5;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .error-notification {
            background: #d93025;
        }

        .multi-select {
            position: relative;
        }

        .multi-select-display {
            padding: 8px;
            border: 1px solid #444444;
            border-radius: 6px;
            cursor: pointer;
            min-height: 38px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            background: #333333;
            transition: border-color 0.2s ease;
        }

        .multi-select-display:hover {
            border-color: #4c8bf5;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #333333;
            border: 1px solid #444444;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .multi-select-dropdown.show {
            display: block;
        }

        .multi-select-option {
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.2s ease;
        }

        .multi-select-option:hover {
            background: #3a3a3a;
        }

        .multi-select-option input {
            margin-right: 8px;
            width: auto;
        }

        .selected-tag {
            background: #4c8bf5;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
        }

        .selected-tag .remove {
            margin-left: 5px;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .referrer-selector {
            background: #333333;
            border: 1px solid #444444;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .referrer-option {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .referrer-option:hover {
            background: #3a3a3a;
        }

        .referrer-option .info {
            font-size: 12px;
            color: #aaaaaa;
        }

        /* ãƒªãƒ³ã‚¯ */
        a {
            color: #4c8bf5;
            text-decoration: none;
            transition: opacity 0.2s ease;
        }

        a:hover {
            opacity: 0.8;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 50%;
            border-top-color: #4c8bf5;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .loading-content {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
        }

        /* èªè¨¼ç”»é¢ */
        .auth-container {
            max-width: 500px;
            margin: 100px auto;
            text-align: center;
            padding: 40px;
            background: #2a2a2a;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }

        .auth-container h2 {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .auth-container p {
            color: #aaaaaa;
            margin-bottom: 30px;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #444444;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555555;
        }

        /* ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .draft-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #333333;
            color: #aaaaaa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .draft-status.show {
            display: block;
            opacity: 1;
        }

        .token-refresh-indicator {
            background: #4c8bf5;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2001;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            align-items: center;
            gap: 10px;
        }

        .token-refresh-indicator.show {
            display: flex;
        }

        .token-refresh-indicator .loading {
            width: 16px;
            height: 16px;
            border-width: 2px;
        }

        /* è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
        .view-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #333333;
            border-radius: 6px;
            padding: 4px;
            border: 1px solid #444444;
        }

        .view-toggle button {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: #aaaaaa;
            font-size: 13px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .view-toggle button.active {
            background: #4c8bf5;
            color: white;
        }

        .view-toggle button:hover:not(.active) {
            background: #3a3a3a;
        }

        /* ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .contact-list-item {
            display: flex;
            align-items: center;
            gap: 16px;
            background: #2a2a2a;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #3a3a3a;
        }

        .contact-list-item:hover {
            border-color: #4c8bf5;
            box-shadow: 0 0 20px rgba(76, 139, 245, 0.1);
        }

        .contact-list-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #333333;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
            font-weight: 300;
            color: #aaaaaa;
            border: 1px solid #444444;
        }

        .contact-list-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .contact-list-info {
            flex: 1;
            min-width: 0;
        }

        .contact-list-name {
            font-size: 16px;
            font-weight: 400;
            color: #f0f0f0;
            margin-bottom: 4px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .contact-list-company {
            font-size: 14px;
            color: #aaaaaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contact-list-meeting {
            font-size: 13px;
            color: #4c8bf5;
            white-space: nowrap;
        }

        /* è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ãƒ»æ¥ç¶šçŠ¶æ…‹ */
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }

        .connection-indicator {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .connection-dot.connected {
            background-color: #34a853;
            box-shadow: 0 0 8px rgba(52, 168, 83, 0.5);
        }

        .connection-dot.disconnected {
            background-color: #d93025;
            box-shadow: 0 0 8px rgba(217, 48, 37, 0.5);
        }

        .connection-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333333;
            color: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border: 1px solid #444444;
        }

        .connection-indicator:hover .connection-tooltip {
            opacity: 1;
        }

        .settings-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #333333;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #444444;
        }

        .settings-icon:hover {
            background: #3a3a3a;
            border-color: #4c8bf5;
        }

        /* è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */
        .settings-modal .modal-content {
            max-width: 500px;
        }

        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #333333;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #444444;
        }

        .settings-item:hover {
            background: #3a3a3a;
            border-color: #4c8bf5;
        }

        .settings-item-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .settings-item-content {
            flex: 1;
        }

        .settings-item-title {
            font-size: 16px;
            color: #f0f0f0;
            margin-bottom: 4px;
        }

        .settings-item-description {
            font-size: 13px;
            color: #aaaaaa;
        }

        /* æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒˆã‚°ãƒ« */
        .search-filters.collapsed {
            max-height: 60px;
            overflow: hidden;
        }

        .filter-toggle {
            cursor: pointer;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #4c8bf5;
            font-size: 14px;
        }

        .filter-toggle:hover {
            opacity: 0.8;
        }

        .filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .filter-content.show {
            max-height: 500px;
        }

        /* ååˆºç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
        .card-image-zone {
            border: 2px dashed #444444;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #333333;
            color: #aaaaaa;
            margin-top: 10px;
        }

        .card-image-zone:hover,
        .card-image-zone.dragover {
            border-color: #4c8bf5;
            background: #2a2a2a;
            color: #f0f0f0;
        }

        .camera-button {
            margin-top: 10px;
            display: none;
        }

        .camera-supported .camera-button {
            display: inline-block;
        }

        /* é€£çµ¡å…ˆè©³ç´°ã®ã‚¿ãƒ–è¡¨ç¤º */
        .detail-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #444444;
            margin-bottom: 20px;
        }

        .detail-tab {
            padding: 12px 20px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: #aaaaaa;
            font-size: 14px;
            position: relative;
            transition: all 0.2s ease;
        }

        .detail-tab:hover {
            color: #f0f0f0;
        }

        .detail-tab.active {
            color: #4c8bf5;
        }

        .detail-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #4c8bf5;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .tab-panel {
            padding: 20px 0;
        }

        /* éå»ã®çµŒæ­´å…¥åŠ›è¡¨ç¤ºåˆ¶å¾¡ */
        .career-history-section {
            display: none;
        }

        .career-history-section.show {
            display: block;
        }

        /* é€£çµ¡å…ˆãƒ•ã‚©ãƒ¼ãƒ 2æ®µçµ„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-grid .form-group {
            margin-bottom: 0;
        }

        .form-grid .form-group.full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .first-meeting-section {
            background: #333333;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .first-meeting-section h4 {
            margin: 0 0 20px 0;
            color: #4c8bf5;
            font-weight: 400;
        }

        /* ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .template-editor {
            display: none;
        }

        .template-editor textarea {
            min-height: 300px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .template-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ -->
        <div id="setupWizard" class="setup-wizard">
            <div class="setup-header">
                <h1>1to1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
                <p>Google Driveã¨é€£æºã—ã¦ã€å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã¾ã™</p>
            </div>
            
            <div class="step-indicator">
                <div class="step-dot active" id="step1Dot">1</div>
                <div class="step-dot" id="step2Dot">2</div>
                <div class="step-dot" id="step3Dot">3</div>
                <div class="step-dot" id="step4Dot">4</div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ã‚ˆã†ã“ã -->
            <div class="setup-step active" id="step1">
                <div class="setup-content">
                    <h2>ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™</h2>
                    <p>ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã§ã¯ã€Google Driveã¨ã®é€£æºè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p>
                    <p style="margin-top: 20px;">å¿…è¦ãªã‚‚ã®ï¼š</p>
                    <ul style="color: #aaaaaa; margin-left: 20px;">
                        <li>Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</li>
                        <li>Google Cloud Console ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç„¡æ–™ï¼‰</li>
                        <li>ç´„10åˆ†ã®è¨­å®šæ™‚é–“</li>
                    </ul>
                    
                    <div style="background: #333; border: 1px solid #444; border-radius: 6px; padding: 20px; margin-top: 20px;">
                        <p style="color: #ff9800; margin: 0;">
                            <strong>âš ï¸ é‡è¦ï¼šãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ¶é™</strong><br>
                            ã“ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã„ã‚‹å ´åˆï¼ˆfile://ï¼‰ã€<br>
                            Googleèªè¨¼ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
                        </p>
                        <ol style="margin-top: 10px; margin-left: 20px; color: #aaaaaa;">
                            <li>PythonãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼š<br>
                                <code style="background: #222; padding: 2px 6px; border-radius: 3px;">python -m http.server 8000</code><br>
                                ãã®å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://localhost:8000</code> ã‚’é–‹ã
                            </li>
                            <li>Node.jsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼š<br>
                                <code style="background: #222; padding: 2px 6px; border-radius: 3px;">npx http-server -p 8000</code><br>
                                ãã®å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://localhost:8000</code> ã‚’é–‹ã
                            </li>
                            <li>Webã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œ</li>
                        </ol>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" onclick="nextStep()">é–‹å§‹ã™ã‚‹</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: Google Cloud Project ä½œæˆ -->
            <div class="setup-step" id="step2">
                <div class="setup-content">
                    <h2>Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</h2>
                    <p>ä»¥ä¸‹ã®æ‰‹é †ã§Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€Drive APIã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ï¼š</p>
                    
                    <ol style="color: #aaaaaa; margin-left: 20px; line-height: 2;">
                        <li><a href="https://console.cloud.google.com/projectcreate" target="_blank">Google Cloud Console</a> ã‚’é–‹ã</li>
                        <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã«ã€Œ1to1 Meeting Managerã€ã¨å…¥åŠ›</li>
                        <li>ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚ŒãŸã‚‰ã€<a href="https://console.cloud.google.com/apis/library/drive.googleapis.com" target="_blank">Google Drive API</a> ã‚’é–‹ã</li>
                        <li>ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    </ol>
                    
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('project-name')">ã‚³ãƒ”ãƒ¼</button>
                        <code id="project-name">1to1 Meeting Manager</code>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-secondary" onclick="previousStep()">æˆ»ã‚‹</button>
                    <button class="btn-primary" onclick="nextStep()">æ¬¡ã¸</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: OAuthè¨­å®š -->
            <div class="setup-step" id="step3">
                <div class="setup-content">
                    <h2>èªè¨¼æƒ…å ±ã®ä½œæˆ</h2>
                    <p>OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä½œæˆã—ã¾ã™ï¼š</p>
                    
                    <ol style="color: #aaaaaa; margin-left: 20px; line-height: 2;">
                        <li><a href="https://console.cloud.google.com/apis/credentials" target="_blank">èªè¨¼æƒ…å ±ãƒšãƒ¼ã‚¸</a> ã‚’é–‹ã</li>
                        <li>ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>ã€ŒåŒæ„ç”»é¢ã‚’æ§‹æˆã€ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ï¼šã€Œå¤–éƒ¨ã€ã‚’é¸æŠ</li>
                                <li>ã‚¢ãƒ—ãƒªåï¼šã€Œ1to1 Meeting Managerã€</li>
                                <li>ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ï¼šã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</li>
                                <li>æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼šç©ºæ¬„ã§OK</li>
                            </ul>
                        </li>
                        <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡ï¼šã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’é¸æŠ</li>
                        <li>åå‰ï¼šã€Œ1to1 Meeting Web Clientã€</li>
                        <li>æ‰¿èªæ¸ˆã¿ã®JavaScriptç”Ÿæˆå…ƒï¼šä»¥ä¸‹ã®å€¤ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘</li>
                    </ol>
                    
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('origin-url')">ã‚³ãƒ”ãƒ¼</button>
                        <code id="origin-url"></code>
                    </div>
                    
                    <div style="background: #333; border: 1px solid #444; border-radius: 6px; padding: 15px; margin-top: 10px;">
                        <p style="color: #4c8bf5; margin: 0; font-size: 14px;">
                            ğŸ’¡ <strong>ãƒ’ãƒ³ãƒˆï¼š</strong>è¤‡æ•°ã®ç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®URLã‚’ã™ã¹ã¦è¿½åŠ ã—ã¦ãã ã•ã„ï¼š
                        </p>
                        <ul style="margin-top: 8px; margin-left: 20px; color: #aaaaaa; font-size: 13px;">
                            <li>http://localhost:8000 ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰</li>
                            <li>http://localhost:3000 ï¼ˆåˆ¥ã®ãƒãƒ¼ãƒˆï¼‰</li>
                            <li>https://ã‚ãªãŸã®ãƒ‰ãƒ¡ã‚¤ãƒ³.com ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰</li>
                        </ul>
                    </div>
                    
                    <p style="margin-top: 20px;">ä½œæˆå¾Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸‹ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š</p>
                    <div class="form-group">
                        <input type="text" id="clientIdInput" placeholder="ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’è²¼ã‚Šä»˜ã‘ï¼ˆä¾‹ï¼š123456789-abcdef.apps.googleusercontent.comï¼‰">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-secondary" onclick="previousStep()">æˆ»ã‚‹</button>
                    <button class="btn-primary" onclick="validateAndProceed()">æ¬¡ã¸</button>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—4: å®Œäº† -->
            <div class="setup-step" id="step4">
                <div class="setup-content">
                    <h2>ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼</h2>
                    <p>è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®æƒ…å ±ã¯å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ï¼š</p>
                    
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('final-config')">ã‚³ãƒ”ãƒ¼</button>
                        <code id="final-config"></code>
                    </div>
                    
                    <p style="margin-top: 20px;">ã“ã®è¨­å®šã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›ã‹ã‚‰ã¯è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚</p>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" onclick="completeSetup()">ã‚¢ãƒ—ãƒªã‚’é–‹å§‹</button>
                </div>
            </div>
        </div>

        <!-- èªè¨¼ç”»é¢ -->
        <div id="authContainer" class="auth-container" style="display: none;">
            <h2>1to1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h2>
            <p>Google Driveã¨é€£æºã—ã¦ã€é€£çµ¡å…ˆã¨ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ã—ã¾ã™ã€‚</p>
            <button class="btn-google" onclick="authenticateGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            <p style="margin-top: 20px; font-size: 12px;">
                <a href="#" onclick="showSetupWizard(); return false;">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ãªå ´åˆã¯ã“ã¡ã‚‰</a>
            </p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="mainContainer" class="container" style="display: none;">
            <header>
                <div class="header-content">
                    <h1>1to1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
                    <div class="header-right">
                        <div class="connection-indicator">
                            <div class="connection-dot" id="connectionDot"></div>
                            <div class="connection-tooltip" id="connectionTooltip">æœªæ¥ç¶š</div>
                        </div>
                        <div class="settings-icon" onclick="showSettingsModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                            </svg>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="showContactForm()">æ–°è¦é€£çµ¡å…ˆç™»éŒ²</button>
                </div>
            </header>

            <!-- æ¤œç´¢ãƒãƒ¼ -->
            <div class="search-bar">
                <label>ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</label>
                <input type="text" id="searchName" placeholder="åå‰ã€ã‚ˆã¿ã€ä¼šç¤¾ã€ãƒ¡ãƒ¼ãƒ«ã€ã‚¿ã‚°ã€å†…å®¹ãªã©ã‚’æ¤œç´¢..." onkeyup="filterContacts()">
            </div>

            <!-- è¡¨ç¤ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ -->
            <div class="view-controls">
                <div class="view-sort-wrapper">
                    <div class="sort-controls">
                        <label>ä¸¦ã³æ›¿ãˆ:</label>
                        <select id="sortOrder" onchange="applySorting()">
                            <option value="meeting-desc">æœ€çµ‚æ‰“åˆã›æ—¥ (æ–°ã—ã„é †)</option>
                            <option value="meeting-asc">æœ€çµ‚æ‰“åˆã›æ—¥ (å¤ã„é †)</option>
                            <option value="name-asc">åå‰ (Aâ†’Z)</option>
                            <option value="name-desc">åå‰ (Zâ†’A)</option>
                            <option value="yomi-asc">ã‚ˆã¿ (ã‚â†’ã‚“)</option>
                            <option value="yomi-desc">ã‚ˆã¿ (ã‚“â†’ã‚)</option>
                        </select>
                    </div>
                    <div class="view-toggle">
                        <button id="cardViewBtn" class="active" onclick="setViewMode('card')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 3h8v8H3V3m10 0h8v8h-8V3M3 13h8v8H3v-8m10 0h8v8h-8v-8Z"/>
                            </svg>
                            ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
                        </button>
                        <button id="listViewBtn" onclick="setViewMode('list')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 4h18v2H3V4m0 7h18v2H3v-2m0 7h18v2H3v-2Z"/>
                            </svg>
                            ãƒªã‚¹ãƒˆè¡¨ç¤º
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div class="search-filters" id="searchFilters">
                <div class="search-header">
                    <h3>
                        <span class="filter-toggle" onclick="toggleFilters()">
                            <span id="filterToggleIcon">â–¶</span>
                            è©³ç´°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                        </span>
                    </h3>
                </div>
                <div class="filter-content" id="filterContent">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>ç¨®åˆ¥</label>
                            <select id="filterType" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>æ‰€å±ãƒ»ãƒãƒ£ãƒ—ã‚¿ãƒ¼</label>
                            <select id="filterAffiliation" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ç¹‹ãŒã‚ŠãŸã„äººãƒ»æ¥­ç¨®</label>
                            <select id="filterWantToConnect" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>é‡‘ã®åµ</label>
                            <select id="filterGoldenEgg" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ç´¹ä»‹å…ƒ</label>
                            <select id="filterReferredBy" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ã‚¨ãƒªã‚¢</label>
                            <select id="filterArea" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>å±…ä½åœ°</label>
                            <select id="filterResidence" onchange="filterContacts()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Outstanding Actions Dashboard -->
            <div id="outstandingActions" class="search-filters" style="margin-bottom: 24px;">
                <div class="search-header">
                    <h3>æœªå®Œäº†ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                    <button class="btn-small btn-secondary" onclick="toggleOutstandingActions()">
                        <span id="toggleActionsText">è¡¨ç¤º</span>
                    </button>
                </div>
                <div id="outstandingActionsList" style="display: none; margin-top: 20px;">
                    <!-- Outstanding actions will be rendered here -->
                </div>
            </div>

            <div id="contactGrid" class="contact-grid">
                <!-- é€£çµ¡å…ˆã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <!-- é€£çµ¡å…ˆç™»éŒ²/ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="contactFormModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="contactFormTitle">æ–°è¦é€£çµ¡å…ˆç™»éŒ²</h2>
                <span class="close-modal" onclick="closeModal('contactFormModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contactForm" onsubmit="saveContactForm(event)">
                    <!-- åŸºæœ¬æƒ…å ±ï¼ˆ2æ®µçµ„ï¼‰ -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label>æ°å <span style="color: #d93025;">*</span></label>
                            <input type="text" name="name" required>
                        </div>

                        <div class="form-group">
                            <label>ã‚ˆã¿</label>
                            <input type="text" name="yomi" placeholder="ã²ã‚‰ãŒãªã§å…¥åŠ›ã—ã¦ãã ã•ã„">
                        </div>

                        <div class="form-group">
                            <label>ä¼šç¤¾å</label>
                            <input type="text" name="company">
                        </div>

                        <div class="form-group">
                            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" name="email">
                        </div>

                        <div class="form-group">
                            <label>é›»è©±ç•ªå·</label>
                            <input type="tel" name="phone">
                        </div>

                        <div class="form-group">
                            <label>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</label>
                            <input type="url" name="homepage">
                        </div>

                        <div class="form-group">
                            <label>ç¨®åˆ¥</label>
                            <div class="multi-select">
                                <div class="multi-select-display" onclick="toggleMultiSelect('types')">
                                    <span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>
                                </div>
                                <div id="types-dropdown" class="multi-select-dropdown"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>æ‰€å±ãƒ»ãƒãƒ£ãƒ—ã‚¿ãƒ¼</label>
                            <div class="multi-select">
                                <div class="multi-select-display" onclick="toggleMultiSelect('affiliations')">
                                    <span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>
                                </div>
                                <div id="affiliations-dropdown" class="multi-select-dropdown"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>ç¹‹ãŒã‚ŠãŸã„äººãƒ»æ¥­ç¨®</label>
                            <div class="multi-select">
                                <div class="multi-select-display" onclick="toggleMultiSelect('wantToConnect')">
                                    <span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>
                                </div>
                                <div id="wantToConnect-dropdown" class="multi-select-dropdown"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>é‡‘ã®åµ</label>
                            <div class="multi-select">
                                <div class="multi-select-display" onclick="toggleMultiSelect('goldenEgg')">
                                    <span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>
                                </div>
                                <div id="goldenEgg-dropdown" class="multi-select-dropdown"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>ã‚¨ãƒªã‚¢</label>
                            <input type="text" name="area" placeholder="ä¾‹: é–¢æ±ã€é–¢è¥¿ã€ä¹å·ãªã©">
                        </div>

                        <div class="form-group">
                            <label>å±…ä½åœ°</label>
                            <input type="text" name="residence" placeholder="ä¾‹: æ±äº¬éƒ½æ¸¯åŒº">
                        </div>

                        <div class="form-group">
                            <label>ç´¹ä»‹å…ƒ</label>
                            <input type="text" name="referredBy" placeholder="ç´¹ä»‹è€…ã®åå‰ã‚’å…¥åŠ›">
                        </div>
                    </div>

                    <!-- å…¨å¹…é …ç›® -->
                    <div class="form-group">
                        <label>é¡”å†™çœŸ</label>
                        <div class="file-drop-zone" id="photoDropZone">
                            å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<span class="upload-hint">ï¼ˆã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰</span>
                        </div>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                        <div id="photoPreview"></div>
                    </div>

                    <div class="form-group">
                        <label>ååˆºç”»åƒ</label>
                        <div class="file-drop-zone card-image-zone" id="cardImageDropZone">
                            ååˆºç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<span class="upload-hint">ï¼ˆã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰</span>
                        </div>
                        <input type="file" id="cardImageUpload" accept="image/*" style="display: none;" onchange="handleCardImageUpload(event)">
                        <div id="cardImagePreview"></div>
                    </div>

                    <div class="form-group">
                        <label>å¼·ã¿</label>
                        <textarea name="strengths" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>éå»ã®çµŒæ­´</label>
                        <textarea name="careerHistory" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>åˆ‡ã‚Šå‡ºã—æ–¹</label>
                        <textarea name="cutout" rows="3" placeholder="Markdownè¨˜æ³•ãŒä½¿ãˆã¾ã™"></textarea>
                    </div>

                    <div class="form-group">
                        <label>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</label>
                        <div class="file-drop-zone" id="attachmentDropZone">
                            ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
                        </div>
                        <input type="file" id="attachmentUpload" multiple style="display: none;">
                        <div id="existingAttachments" class="file-list"></div>
                        <div id="newAttachments" class="file-list"></div>
                    </div>

                    <!-- åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç·¨é›†æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
                    <div class="first-meeting-section" id="firstMeetingSection" style="display: none;">
                        <h4>åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±</h4>
                        <div class="form-group">
                            <label>æ—¥æ™‚</label>
                            <input type="datetime-local" name="firstMeetingDatetime">
                        </div>
                        <div class="form-group">
                            <label>æ‰“ã¡åˆã‚ã›å†…å®¹</label>
                            <textarea name="firstMeetingContent" rows="5" placeholder="Markdownè¨˜æ³•ãŒä½¿ãˆã¾ã™"></textarea>
                        </div>
                        <div class="form-group">
                            <label>æ¬¡å›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                            <div id="firstMeetingTaskContainer"></div>
                            <button type="button" class="btn-small btn-secondary" onclick="addFirstMeetingTask()">+ ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
                        </div>
                        <div class="form-group">
                            <label>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</label>
                            <div class="file-drop-zone" id="firstMeetingAttachmentDropZone">
                                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
                            </div>
                            <input type="file" id="firstMeetingAttachmentUpload" multiple style="display: none;">
                            <div id="firstMeetingAttachments" class="file-list"></div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                        <button type="button" class="btn-secondary" onclick="closeModal('contactFormModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- é€£çµ¡å…ˆè©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="contactDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>é€£çµ¡å…ˆè©³ç´°</h2>
                <span class="close-modal" onclick="closeModal('contactDetailModal')">&times;</span>
            </div>
            <div id="contactDetailBody" class="modal-body">
                <!-- è©³ç´°æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <!-- ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="meetingFormModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="meetingFormTitle">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²</h2>
                <span class="close-modal" onclick="closeModal('meetingFormModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="meetingForm" onsubmit="saveMeetingForm(event)">
                    <div class="form-group">
                        <label>æ—¥æ™‚ <span style="color: #d93025;">*</span></label>
                        <input type="datetime-local" name="datetime" required>
                    </div>

                    <div class="form-group">
                        <label>æ‰“ã¡åˆã‚ã›å†…å®¹ <span style="color: #d93025;">*</span></label>
                        <textarea name="content" rows="5" required placeholder="Markdownè¨˜æ³•ãŒä½¿ãˆã¾ã™"></textarea>
                    </div>

                    <div class="form-group">
                        <label>æ¬¡å›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                        <div id="taskInputContainer"></div>
                        <button type="button" class="btn-small btn-secondary btn-add-task" onclick="addTaskInput()">+ ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
                    </div>

                    <div class="form-group">
                        <label>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</label>
                        <div class="file-drop-zone" id="meetingAttachmentDropZone">
                            ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
                        </div>
                        <input type="file" id="meetingAttachmentUpload" multiple style="display: none;">
                        <div id="existingMeetingAttachments" class="file-list"></div>
                        <div id="newMeetingAttachments" class="file-list"></div>
                    </div>

                    <div class="action-buttons">
                        <button type="submit" class="btn-primary">ä¿å­˜</button>
                        <button type="button" class="btn-secondary" onclick="closeModal('meetingFormModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="settingsModal" class="modal settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è¨­å®š</h2>
                <span class="close-modal" onclick="closeModal('settingsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-list">
                    <div class="settings-item" onclick="syncData()">
                        <div class="settings-item-icon">ğŸ”„</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">åŒæœŸ</div>
                            <div class="settings-item-description">Google Driveã¨æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã—ã¾ã™</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="exportData()">
                        <div class="settings-item-icon">ğŸ“¤</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
                            <div class="settings-item-description">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="document.getElementById('importInput').click()">
                        <div class="settings-item-icon">ğŸ“¥</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>
                            <div class="settings-item-description">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="showTemplateEditor()">
                        <div class="settings-item-icon">ğŸ“</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</div>
                            <div class="settings-item-description">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å†…å®¹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†ã—ã¾ã™</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="showSetupWizard()">
                        <div class="settings-item-icon">âš™ï¸</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
                            <div class="settings-item-description">Google Drive APIã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™</div>
                        </div>
                    </div>
                    <div class="settings-item" onclick="logout()">
                        <div class="settings-item-icon">ğŸšª</div>
                        <div class="settings-item-content">
                            <div class="settings-item-title">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
                            <div class="settings-item-description">Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã®æ¥ç¶šã‚’è§£é™¤ã—ã¾ã™</div>
                        </div>
                    </div>
                </div>
                <div class="template-editor" id="templateEditor">
                    <h3 style="margin-bottom: 20px;">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å†…å®¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
                    <div class="form-group">
                        <label>Markdownãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
                        <textarea id="templateContent" placeholder="## è­°é¡Œ&#10;&#10;## æ±ºå®šäº‹é …&#10;&#10;## æ¬¡å›ã¾ã§ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³&#10;"></textarea>
                    </div>
                    <div class="template-actions">
                        <button class="btn-primary" onclick="saveTemplate()">ä¿å­˜</button>
                        <button class="btn-secondary" onclick="hideTemplateEditor()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¤ãƒ³ãƒãƒ¼ãƒˆç”¨ã®éš ã—input -->
    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="importData(event)">

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading"></div>
            <p style="margin-top: 20px;">å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <div id="draftStatus" class="draft-status">
        ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸ
    </div>

    <script>
        // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° =====
        let CLIENT_ID = localStorage.getItem('google_client_id') || '';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata';
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const APP_FOLDER_NAME = '1to1MeetingManager';
        
        let tokenClient = null;
        let gapiInited = false;
        let gisInited = false;
        let accessToken = null;
        
        let contacts = [];
        let meetings = [];
        let dropdownOptions = {
            types: [],
            affiliations: [],
            goldenEgg: [],
            wantToConnect: [],
            referredBy: []
        };
        
        let currentEditingContactId = null;
        let currentEditingMeetingId = null;
        let selectedFiles = [];
        let selectedMeetingFiles = [];
        let currentPhotoFile = null;
        let currentCardImageFile = null;
        let deletedAttachments = [];
        let deletedMeetingAttachments = [];
        let currentSortOrder = 'meeting-desc';
        let viewMode = localStorage.getItem('viewMode') || 'card';
        let filterVisible = localStorage.getItem('filterVisible') === 'true';
        let appFolderId = null;
        
        // ãƒ‰ãƒ©ãƒ•ãƒˆç®¡ç†ç”¨å¤‰æ•°
        let draftSaveTimer = null;
        let hasUnsavedDraft = false;
        
        let selectedFirstMeetingFiles = [];
        let hasFirstMeeting = {};
        
        let userSettings = {
            viewMode: 'card',
            filterVisible: false,
            meetingTemplate: ''
        };

        // ===== ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ =====
        let currentStep = 1;

        function showSetupWizard() {
            if (document.getElementById('settingsModal')) {
                closeModal('settingsModal');
            }
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('setupWizard').style.display = 'block';
            
            // ç¾åœ¨ã®URLã‚’è¡¨ç¤º
            let origin = window.location.origin;
            if (!origin || origin === 'null' || origin === 'file://') {
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                origin = 'http://localhost:8000';
                document.getElementById('origin-url').textContent = origin;
                // æ³¨æ„æ›¸ãã‚’è¿½åŠ 
                const codeBlock = document.getElementById('origin-url').parentElement;
                if (!codeBlock.querySelector('.local-notice')) {
                    const notice = document.createElement('p');
                    notice.className = 'local-notice';
                    notice.style.cssText = 'color: #ff9800; margin-top: 10px; font-size: 14px;';
                    notice.innerHTML = 'âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚<br>Googleèªè¨¼ã‚’è¡Œã†ã«ã¯ã€Webã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>ä¾‹: python -m http.server 8000';
                    codeBlock.parentElement.insertBefore(notice, codeBlock.nextSibling);
                }
            } else {
                document.getElementById('origin-url').textContent = origin;
            }
        }

        function nextStep() {
            if (currentStep < 4) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.add('completed');
                
                currentStep++;
                
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}Dot`).classList.add('active');
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.remove('active');
                
                currentStep--;
                
                document.getElementById(`step${currentStep}Dot`).classList.remove('completed');
                document.getElementById(`step${currentStep}Dot`).classList.add('active');
                document.getElementById(`step${currentStep}`).classList.add('active');
            }
        }

        function validateAndProceed() {
            const clientId = document.getElementById('clientIdInput').value.trim();
            
            if (!clientId) {
                showNotification('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            if (!clientId.includes('.apps.googleusercontent.com')) {
                showNotification('æ­£ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            CLIENT_ID = clientId;
            localStorage.setItem('google_client_id', CLIENT_ID);
            
            // æœ€çµ‚è¨­å®šã‚’è¡¨ç¤º
            const config = `ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID: ${CLIENT_ID}
ã‚¢ãƒ—ãƒªå: 1to1 Meeting Manager
ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ: Google Drive/${APP_FOLDER_NAME}/

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚ãªãŸã®Google Driveã«å°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€
ãã“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«ä¿å­˜ã—ã¾ã™ã€‚`;
            
            document.getElementById('final-config').textContent = config;
            
            nextStep();
        }

        function completeSetup() {
            document.getElementById('setupWizard').style.display = 'none';
            
            // CLIENT_IDãŒè¨­å®šã•ã‚ŒãŸã®ã§ã€Google APIã‚’åˆæœŸåŒ–
            try {
                // Google Identity Services ã‚’åˆæœŸåŒ–
                google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: handleCredentialResponse
                });
                
                // GIS client ã‚’åˆæœŸåŒ–
                initializeGisClient();
                
                // Google API Client Library ã‚’èª­ã¿è¾¼ã¿
                gapi.load('client', initializeGapiClient);
            } catch (error) {
                console.error('Google APIåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'error');
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            
            // navigator.clipboard APIãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                }).catch(err => {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹æ³•ã‚’ä½¿ç”¨
                fallbackCopyToClipboard(text);
            }
        }
        
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showNotification('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            } catch (err) {
                showNotification('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // ===== Google API åˆæœŸåŒ– =====
        function initializeApp() {
            console.log('=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹ ===');
            console.log('CLIENT_ID:', CLIENT_ID ? 'è¨­å®šæ¸ˆã¿' : 'æœªè¨­å®š');
            
            // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®šã‚’åˆæœŸåŒ–
            initializeViewMode();
            initializeFilterVisibility();
            
            if (!CLIENT_ID) {
                console.log('CLIENT_IDãŒæœªè¨­å®šã®ãŸã‚ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã—ã¾ã™');
                showSetupWizard();
                return;
            }
            
            console.log('Google APIã‚’åˆæœŸåŒ–ã—ã¾ã™');
            
            try {
                // CLIENT_IDãŒã‚ã‚‹å ´åˆã®ã¿Google APIã‚’åˆæœŸåŒ–
                // Google Identity Services ã‚’åˆæœŸåŒ–
                google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: handleCredentialResponse
                });
                
                // GIS client ã‚’åˆæœŸåŒ–
                initializeGisClient();
                
                // Google API Client Library ã‚’èª­ã¿è¾¼ã¿
                gapi.load('client', initializeGapiClient);
            } catch (error) {
                console.error('Google APIåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showSetupWizard();
            }
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                discoveryDocs: DISCOVERY_DOCS,
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function initializeGisClient() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (response) => {
                    if (response.error !== undefined) {
                        throw (response);
                    }
                    accessToken = response.access_token;
                    localStorage.setItem('google_access_token', accessToken);
                    handleAuthSuccess();
                },
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                // ä¿å­˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
                const savedToken = localStorage.getItem('google_access_token');
                if (savedToken) {
                    gapi.client.setToken({ access_token: savedToken });
                    accessToken = savedToken;
                    validateTokenAndInitialize();
                } else {
                    showAuthScreen();
                }
            }
        }

        async function validateTokenAndInitialize() {
            try {
                // ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
                await gapi.client.drive.about.get({ fields: 'user' });
                handleAuthSuccess();
            } catch (error) {
                console.error('Token validation failed:', error);
                localStorage.removeItem('google_access_token');
                showAuthScreen();
            }
        }

        // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–
        function initializeViewMode() {
            if (viewMode === 'list') {
                document.getElementById('cardViewBtn').classList.remove('active');
                document.getElementById('listViewBtn').classList.add('active');
            }
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡¨ç¤ºçŠ¶æ…‹åˆæœŸåŒ–
        function initializeFilterVisibility() {
            const filterContent = document.getElementById('filterContent');
            const toggleIcon = document.getElementById('filterToggleIcon');
            
            if (!filterVisible) {
                filterContent.classList.remove('show');
                toggleIcon.textContent = 'â–¶';
            } else {
                filterContent.classList.add('show');
                toggleIcon.textContent = 'â–¼';
            }
        }

        // ===== èªè¨¼ =====
        function authenticateGoogle() {
            if (!CLIENT_ID) {
                showNotification('å…ˆã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Œäº†ã—ã¦ãã ã•ã„', 'error');
                showSetupWizard();
                return;
            }
            
            if (tokenClient) {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else {
                showNotification('èªè¨¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'error');
            }
        }

        function showAuthScreen() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('mainContainer').style.display = 'none';
            updateConnectionStatus();
        }

        async function handleAuthSuccess() {
            try {
                showLoading();
                
                // ã‚¢ãƒ—ãƒªãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ/å–å¾—
                await ensureAppFolder();
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                await loadData();
                
                // é¡”å†™çœŸURLã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                migratePhotoUrls();
                
                // UIã‚’è¡¨ç¤º
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                
                // è¨­å®šã‚’é©ç”¨
                initializeViewMode();
                initializeFilterVisibility();
                
                updateConnectionStatus();
                updateDropdownOptions();
                renderContactList();
                renderOutstandingActions();
                
                hideLoading();
                showNotification('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Initialization error:', error);
                hideLoading();
                showNotification('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        function logout() {
            closeModal('settingsModal');
            
            if (tokenClient) {
                google.accounts.oauth2.revoke(accessToken, () => {
                    console.log('Token revoked');
                });
            }
            
            localStorage.removeItem('google_access_token');
            gapi.client.setToken(null);
            accessToken = null;
            
            window.location.reload();
        }

        // ===== Google Drive æ“ä½œ =====
        async function ensureAppFolder() {
            try {
                // ã‚¢ãƒ—ãƒªãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¤œç´¢
                const response = await gapi.client.drive.files.list({
                    q: `name='${APP_FOLDER_NAME}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });
                
                if (response.result.files && response.result.files.length > 0) {
                    appFolderId = response.result.files[0].id;
                } else {
                    // ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ
                    const folderResponse = await gapi.client.drive.files.create({
                        resource: {
                            name: APP_FOLDER_NAME,
                            mimeType: 'application/vnd.google-apps.folder'
                        },
                        fields: 'id'
                    });
                    appFolderId = folderResponse.result.id;
                }
                
                console.log('App folder ID:', appFolderId);
            } catch (error) {
                console.error('Error creating app folder:', error);
                throw error;
            }
        }

        async function saveJsonFile(fileName, data) {
            const boundary = '-------314159265358979323846';
            const delimiter = "\r\n--" + boundary + "\r\n";
            const close_delim = "\r\n--" + boundary + "--";
            
            const metadata = {
                name: fileName,
                mimeType: 'application/json',
                parents: [appFolderId]
            };
            
            const multipartRequestBody =
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(metadata) +
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(data, null, 2) +
                close_delim;
            
            try {
                // æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
                const searchResponse = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and '${appFolderId}' in parents and trashed=false`,
                    fields: 'files(id)'
                });
                
                let fileId;
                if (searchResponse.result.files && searchResponse.result.files.length > 0) {
                    fileId = searchResponse.result.files[0].id;
                    
                    // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
                    await gapi.client.request({
                        path: `/upload/drive/v3/files/${fileId}`,
                        method: 'PATCH',
                        params: { uploadType: 'multipart' },
                        headers: {
                            'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                        },
                        body: multipartRequestBody
                    });
                } else {
                    // æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
                    await gapi.client.request({
                        path: '/upload/drive/v3/files',
                        method: 'POST',
                        params: { uploadType: 'multipart' },
                        headers: {
                            'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                        },
                        body: multipartRequestBody
                    });
                }
            } catch (error) {
                console.error('Error saving file:', error);
                throw error;
            }
        }

        async function loadJsonFile(fileName) {
            try {
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
                const searchResponse = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and '${appFolderId}' in parents and trashed=false`,
                    fields: 'files(id)'
                });
                
                if (!searchResponse.result.files || searchResponse.result.files.length === 0) {
                    return null;
                }
                
                const fileId = searchResponse.result.files[0].id;
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å–å¾—
                const response = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });
                
                return response.result;
            } catch (error) {
                console.error('Error loading file:', error);
                return null;
            }
        }

        async function uploadFile(file, customName = null) {
            const fileName = customName || file.name;
            const metadata = {
                name: fileName,
                parents: [appFolderId]
            };
            
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);
            
            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink,webContentLink', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: form
                });
                
                if (!response.ok) {
                    throw new Error('Upload failed');
                }
                
                const result = await response.json();
                
                // å…±æœ‰å¯èƒ½ãªURLã‚’ç”Ÿæˆ
                const shareUrl = `https://drive.google.com/uc?export=view&id=${result.id}`;
                
                return {
                    id: result.id,
                    url: shareUrl
                };
            } catch (error) {
                console.error('Error uploading file:', error);
                throw error;
            }
        }

        // ===== ãƒ‡ãƒ¼ã‚¿ç®¡ç† =====
        async function loadData() {
            try {
                // è¨­å®šã‚’èª­ã¿è¾¼ã¿
                await loadOptions();
                
                const contactsData = await loadJsonFile('contacts.json');
                contacts = contactsData || [];
                
                const meetingsData = await loadJsonFile('meetings.json');
                meetings = meetingsData || [];
                
                // ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå‡¦ç†
                migrateMeetingsData();
                migrateContactsData();
                
                // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
                if (Object.keys(dropdownOptions).every(key => dropdownOptions[key].length === 0)) {
                    const optionsData = await loadJsonFile('options.json');
                    if (optionsData && optionsData.dropdownOptions) {
                        dropdownOptions = optionsData.dropdownOptions;
                    }
                }
                
                // ç´¹ä»‹å…ƒãƒªãƒ³ã‚¯ã‚’æ›´æ–°
                updateAllReferrerLinks();
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        async function saveData() {
            try {
                showLoading();
                
                await saveJsonFile('contacts.json', contacts);
                await saveJsonFile('meetings.json', meetings);
                
                // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’ä¿å­˜
                const optionsData = {
                    dropdownOptions: dropdownOptions,
                    userSettings: userSettings
                };
                await saveJsonFile('options.json', optionsData);
                
                hideLoading();
                showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Error saving data:', error);
                hideLoading();
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                throw error;
            }
        }

        async function syncData() {
            try {
                closeModal('settingsModal');
                showNotification('åŒæœŸä¸­...', 'info');
                await loadData();
                
                // åŒæœŸæ™‚ã«ã‚‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
                migratePhotoUrls();
                
                renderContactList();
                updateDropdownOptions();
                showNotification('åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Sync error:', error);
                showNotification('åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // é¡”å†™çœŸURLã‚’Google Driveå½¢å¼ã«å¤‰æ›
        function toDirectLink(url) {
            if (!url) return url;
            
            // ã™ã§ã«ç›´æ¥ãƒªãƒ³ã‚¯å½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            if (url.includes('drive.google.com/uc')) {
                return url;
            }
            
            // Google Drive IDã‚’æŠ½å‡ºã—ã¦ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒªãƒ³ã‚¯ã«å¤‰æ›
            const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            if (match) {
                return `https://drive.google.com/uc?export=view&id=${match[1]}`;
            }
            
            return url;
        }

        // æ—¢å­˜ã®é¡”å†™çœŸURLã‚’ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function migratePhotoUrls() {
            console.log('=== é¡”å†™çœŸURLã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ ===');
            let migratedCount = 0;
            let needsSave = false;
            
            contacts.forEach(contact => {
                if (contact.photoUrl && !contact.photoUrl.includes('drive.google.com/uc')) {
                    const oldUrl = contact.photoUrl;
                    contact.photoUrl = toDirectLink(contact.photoUrl);
                    needsSave = true;
                    migratedCount++;
                    console.log(`âœ… URLã‚’å¤‰æ›: ${contact.name}`);
                }
            });
            
            if (needsSave) {
                console.log(`ğŸ“Š ${migratedCount}ä»¶ã®é¡”å†™çœŸURLã‚’å¤‰æ›ã—ã¾ã—ãŸ`);
                // éåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                saveData().catch(error => {
                    console.error('ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                });
            }
        }

        // é€£çµ¡å…ˆãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
        function migrateContactsData() {
            let needsSave = false;
            
            contacts.forEach(contact => {
                // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸåŒ–
                if (!contact.hasOwnProperty('yomi')) {
                    contact.yomi = '';
                    needsSave = true;
                }
                if (!contact.hasOwnProperty('cutout')) {
                    contact.cutout = '';
                    needsSave = true;
                }
                if (!contact.hasOwnProperty('cardImage')) {
                    contact.cardImage = '';
                    needsSave = true;
                }
                if (!contact.hasOwnProperty('cardImageUrl')) {
                    contact.cardImageUrl = '';
                    needsSave = true;
                }
            });
            
            if (needsSave) {
                console.log('é€£çµ¡å…ˆãƒ‡ãƒ¼ã‚¿ã«æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            }
        }

        // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œå‡¦ç†
        function migrateMeetingsData() {
            let needsSave = false;
            
            meetings.forEach(meeting => {
                // tasksãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã€æ—¢å­˜ã®nextActionã‹ã‚‰å¤‰æ›
                if (!meeting.hasOwnProperty('tasks')) {
                    meeting.tasks = [];
                    if (meeting.nextAction) {
                        const taskLines = meeting.nextAction.split('\n').filter(line => line.trim());
                        taskLines.forEach((taskText, index) => {
                            meeting.tasks.push({
                                text: taskText.trim(),
                                due: index === 0 ? meeting.nextActionDue : null,
                                done: meeting.nextActionDoneTasks && meeting.nextActionDoneTasks[index] || false
                            });
                        });
                    }
                    needsSave = true;
                }
            });
            
            if (needsSave) {
                console.log('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ–°å½¢å¼ã«ç§»è¡Œã—ã¾ã—ãŸ');
            }
        }

        async function loadOptions() {
            try {
                const optionsData = await loadJsonFile('options.json');
                if (optionsData) {
                    if (optionsData.dropdownOptions) {
                        dropdownOptions = optionsData.dropdownOptions;
                    }
                    if (optionsData.userSettings) {
                        userSettings = optionsData.userSettings;
                        viewMode = userSettings.viewMode || 'card';
                        filterVisible = userSettings.filterVisible || false;
                        if (userSettings.meetingTemplate) {
                            localStorage.setItem('meetingTemplate', userSettings.meetingTemplate);
                        }
                    }
                }
            } catch (error) {
                console.error('è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        async function saveOptions() {
            try {
                userSettings.viewMode = viewMode;
                userSettings.filterVisible = filterVisible;
                userSettings.meetingTemplate = localStorage.getItem('meetingTemplate') || '';
                
                const optionsData = {
                    dropdownOptions: dropdownOptions,
                    userSettings: userSettings
                };
                
                await saveJsonFile('options.json', optionsData);
            } catch (error) {
                console.error('è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ===== é€£çµ¡å…ˆç®¡ç† =====
        function showContactForm(contactId = null) {
            // è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeModal('contactDetailModal');
            
            currentEditingContactId = contactId;
            resetContactForm();
            
            if (contactId) {
                const contact = contacts.find(c => c.id === contactId);
                if (contact) {
                    document.getElementById('contactFormTitle').textContent = 'é€£çµ¡å…ˆç·¨é›†';
                    const form = document.getElementById('contactForm');
                    form.name.value = contact.name || '';
                    form.yomi.value = contact.yomi || '';
                    form.company.value = contact.company || '';
                    form.email.value = contact.email || '';
                    form.phone.value = contact.phone || '';
                    form.homepage.value = contact.homepage || '';
                    form.referredBy.value = contact.referredBy || '';
                    form.strengths.value = contact.strengths || '';
                    form.careerHistory.value = contact.careerHistory || '';
                    form.cutout.value = contact.cutout || '';
                    form.area.value = contact.area || '';
                    form.residence.value = contact.residence || '';
                    
                    // é¡”å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    if (contact.photoUrl) {
                        document.getElementById('photoPreview').innerHTML = 
                            `<img src="${contact.photoUrl}" style="max-width: 200px; margin-top: 10px; border-radius: 8px;" onerror="handleImageError(this, '${escapeHtml(contact.name)}')">`;
                    }
                    
                    // ååˆºç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    if (contact.cardImageUrl) {
                        document.getElementById('cardImagePreview').innerHTML = 
                            `<img src="${contact.cardImageUrl}" style="max-width: 100%; margin-top: 10px; border-radius: 8px;" onerror="handleImageError(this, 'ååˆº')">`;
                    }
                    
                    // ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆè¨­å®š
                    setSelectedValues('types', contact.types || []);
                    setSelectedValues('affiliations', contact.affiliations || []);
                    setSelectedValues('wantToConnect', contact.wantToConnect || []);
                    setSelectedValues('goldenEgg', contact.goldenEgg || []);
                    
                    // æ—¢å­˜ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
                    displayExistingAttachments(contact.attachments || []);
                    
                    // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã®è¡¨ç¤ºåˆ¤å®š
                    const contactMeetings = meetings.filter(m => m.contactId === contactId);
                    hasFirstMeeting[contactId] = contactMeetings.length > 0;
                    
                    if (contactMeetings.length === 0) {
                        // ã¾ã ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒãªã„å ´åˆã¯åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ¬„ã‚’è¡¨ç¤º
                        document.getElementById('firstMeetingSection').style.display = 'block';
                        // ç¾åœ¨æ™‚åˆ»ã‚’è¨­å®š
                        const now = new Date();
                        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                        form.firstMeetingDatetime.value = now.toISOString().slice(0, 16);
                        
                        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
                        const template = localStorage.getItem('meetingTemplate') || '';
                        form.firstMeetingContent.value = template;
                    }
                }
            } else {
                // æ–°è¦ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
                document.getElementById('contactFormTitle').textContent = 'æ–°è¦é€£çµ¡å…ˆç™»éŒ²';
                
                // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('firstMeetingSection').style.display = 'block';
                document.getElementById('firstMeetingSection').classList.add('first-meeting-new');
                
                // ç¾åœ¨æ™‚åˆ»ã‚’è¨­å®š
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.querySelector('input[name="firstMeetingDatetime"]').value = now.toISOString().slice(0, 16);
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
                const template = localStorage.getItem('meetingTemplate') || '';
                document.querySelector('textarea[name="firstMeetingContent"]').value = template;
            }
            
            setupMultiSelect();
            setupFirstMeetingFileDrop();
            document.getElementById('contactFormModal').style.display = 'block';
            document.querySelector('#contactFormModal .modal-content').scrollTop = 0;
        }

        async function saveContactForm(event) {
            event.preventDefault();
            showLoading();
            
            const formData = new FormData(event.target);
            const contact = {
                id: currentEditingContactId || generateId(),
                name: formData.get('name'),
                yomi: formData.get('yomi'),
                company: formData.get('company'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                homepage: formData.get('homepage'),
                referredBy: formData.get('referredBy'),
                strengths: formData.get('strengths'),
                careerHistory: formData.get('careerHistory'),
                cutout: formData.get('cutout'),
                types: getSelectedValues('types'),
                affiliations: getSelectedValues('affiliations'),
                wantToConnect: getSelectedValues('wantToConnect'),
                goldenEgg: getSelectedValues('goldenEgg'),
                area: formData.get('area'),
                residence: formData.get('residence'),
                attachments: [],
                createdAt: currentEditingContactId ? 
                    contacts.find(c => c.id === currentEditingContactId)?.createdAt : 
                    new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // æ—¢å­˜ã®é€£çµ¡å…ˆã®å ´åˆã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
            if (currentEditingContactId) {
                const existing = contacts.find(c => c.id === currentEditingContactId);
                if (existing) {
                    contact.photo = existing.photo;
                    contact.photoUrl = existing.photoUrl;
                    contact.cardImage = existing.cardImage;
                    contact.cardImageUrl = existing.cardImageUrl;
                    contact.attachments = existing.attachments || [];
                }
            }
            
            try {
                // é¡”å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                if (currentPhotoFile) {
                    const timestamp = new Date().getTime();
                    const photoName = `${sanitizeFileName(contact.name)}_${timestamp}_photo.jpg`;
                    const photoResult = await uploadFile(currentPhotoFile, photoName);
                    contact.photo = photoResult.id;
                    contact.photoUrl = photoResult.url;
                }
                
                // ååˆºç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                if (currentCardImageFile) {
                    const timestamp = new Date().getTime();
                    const cardImageName = `ååˆº_${sanitizeFileName(contact.name)}_${timestamp}.jpg`;
                    const cardImageResult = await uploadFile(currentCardImageFile, cardImageName);
                    contact.cardImage = cardImageResult.id;
                    contact.cardImageUrl = cardImageResult.url;
                }
                
                // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                for (const file of selectedFiles) {
                    const timestamp = new Date().getTime();
                    const fileName = `${sanitizeFileName(contact.name)}_${timestamp}_${sanitizeFileName(file.name)}`;
                    const fileResult = await uploadFile(file, fileName);
                    contact.attachments.push({
                        name: file.name,
                        id: fileResult.id,
                        url: fileResult.url,
                        uploadedAt: new Date().toISOString()
                    });
                }
                
                // å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
                contact.attachments = contact.attachments.filter(att => 
                    !deletedAttachments.includes(att.id)
                );
                
                // é€£çµ¡å…ˆã‚’ä¿å­˜
                const index = contacts.findIndex(c => c.id === contact.id);
                if (index >= 0) {
                    contacts[index] = contact;
                } else {
                    contacts.push(contact);
                }
                
                // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã®å‡¦ç†
                const firstMeetingDatetime = formData.get('firstMeetingDatetime');
                const firstMeetingContent = formData.get('firstMeetingContent');
                const firstMeetingSection = document.getElementById('firstMeetingSection');
                
                if (firstMeetingSection.style.display !== 'none' && 
                    (firstMeetingDatetime || firstMeetingContent)) {
                    
                    // ã‚¿ã‚¹ã‚¯æƒ…å ±ã‚’åé›†
                    const taskTexts = Array.from(document.querySelectorAll('#firstMeetingTaskContainer input[name="firstTaskText[]"]')).map(input => input.value);
                    const taskDues = Array.from(document.querySelectorAll('#firstMeetingTaskContainer input[name="firstTaskDue[]"]')).map(input => input.value);
                    
                    const tasks = [];
                    taskTexts.forEach((text, index) => {
                        if (text.trim()) {
                            tasks.push({
                                text: text.trim(),
                                due: taskDues[index] || null,
                                done: false
                            });
                        }
                    });
                    
                    const firstMeeting = {
                        id: generateId(),
                        contactId: contact.id,
                        datetime: firstMeetingDatetime || new Date().toISOString(),
                        content: firstMeetingContent || '',
                        tasks: tasks,
                        attachments: [],
                        isFirstMeeting: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                    for (const file of selectedFirstMeetingFiles) {
                        const timestamp = new Date().getTime();
                        const fileName = `${sanitizeFileName(contact.name)}_firstmeeting_${timestamp}_${sanitizeFileName(file.name)}`;
                        const fileResult = await uploadFile(file, fileName);
                        firstMeeting.attachments.push({
                            name: file.name,
                            id: fileResult.id,
                            url: fileResult.url,
                            uploadedAt: new Date().toISOString()
                        });
                    }
                    
                    // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä¿å­˜
                    meetings.push(firstMeeting);
                }
                
                // ç´¹ä»‹å…ƒãƒªãƒ³ã‚¯ã‚’æ›´æ–°
                updateAllReferrerLinks();
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                await saveData();
                
                // UIã‚’æ›´æ–°
                renderContactList();
                updateDropdownOptions();
                closeModal('contactFormModal');
                resetContactForm();
                
                hideLoading();
                showNotification('é€£çµ¡å…ˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('é€£çµ¡å…ˆä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('é€£çµ¡å…ˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                hideLoading();
            }
        }

        async function deleteContact(contactId) {
            if (!confirm('ã“ã®é€£çµ¡å…ˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\né–¢é€£ã™ã‚‹ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                return;
            }
            
            showLoading();
            
            try {
                // é–¢é€£ã™ã‚‹ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å‰Šé™¤
                meetings = meetings.filter(m => m.contactId !== contactId);
                
                // é€£çµ¡å…ˆã‚’å‰Šé™¤
                contacts = contacts.filter(c => c.id !== contactId);
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                await saveData();
                
                // UIã‚’æ›´æ–°
                renderContactList();
                updateDropdownOptions();
                closeModal('contactDetailModal');
                
                hideLoading();
                showNotification('é€£çµ¡å…ˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('é€£çµ¡å…ˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('é€£çµ¡å…ˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                hideLoading();
            }
        }

        // ===== ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç† =====
        function showMeetingForm(contactId, meetingId = null) {
            currentEditingContactId = contactId;
            currentEditingMeetingId = meetingId;
            resetMeetingForm();
            
            const contact = contacts.find(c => c.id === contactId);
            document.getElementById('meetingFormTitle').textContent = 
                `${contact.name}ã•ã‚“ã¨ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²${meetingId ? 'ç·¨é›†' : ''}`;
            
            if (meetingId) {
                const meeting = meetings.find(m => m.id === meetingId);
                if (meeting) {
                    const form = document.getElementById('meetingForm');
                    form.datetime.value = meeting.datetime;
                    form.content.value = meeting.content || '';
                    
                    // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                    if (meeting.tasks && meeting.tasks.length > 0) {
                        displayTaskInputs(meeting.tasks);
                    }
                    
                    // æ—¢å­˜ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
                    displayExistingMeetingAttachments(meeting.attachments || []);
                }
            } else {
                // æ–°è¦ã®å ´åˆ
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('meetingForm').datetime.value = now.toISOString().slice(0, 16);
                
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
                const template = localStorage.getItem('meetingTemplate') || '';
                document.getElementById('meetingForm').content.value = template;
                
                // ç©ºã®ã‚¿ã‚¹ã‚¯å…¥åŠ›ã‚’1ã¤è¡¨ç¤º
                displayTaskInputs([]);
            }
            
            // ãƒ‰ãƒ©ãƒ•ãƒˆã‚’å¾©å…ƒ
            restoreDraft();
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•ä¿å­˜ã‚’è¨­å®š
            const contentTextarea = document.querySelector('#meetingForm textarea[name="content"]');
            if (contentTextarea) {
                contentTextarea.addEventListener('input', () => {
                    clearTimeout(draftSaveTimer);
                    draftSaveTimer = setTimeout(saveDraft, 5000);
                });
            }
            
            document.getElementById('meetingFormModal').style.display = 'block';
            document.querySelector('#meetingFormModal .modal-content').scrollTop = 0;
        }

        async function saveMeetingForm(event) {
            event.preventDefault();
            showLoading();
            
            const formData = new FormData(event.target);
            const taskTexts = formData.getAll('taskText[]');
            const taskDues = formData.getAll('taskDue[]');
            
            // ã‚¿ã‚¹ã‚¯é…åˆ—ã‚’ä½œæˆ
            const tasks = [];
            taskTexts.forEach((text, index) => {
                if (text.trim()) {
                    tasks.push({
                        text: text.trim(),
                        due: taskDues[index] || null,
                        done: false
                    });
                }
            });
            
            const meeting = {
                id: currentEditingMeetingId || generateId(),
                contactId: currentEditingContactId,
                datetime: formData.get('datetime'),
                content: formData.get('content'),
                tasks: tasks,
                attachments: [],
                createdAt: currentEditingMeetingId ? 
                    meetings.find(m => m.id === currentEditingMeetingId)?.createdAt : 
                    new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // æ—¢å­˜ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å ´åˆã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
            if (currentEditingMeetingId) {
                const existing = meetings.find(m => m.id === currentEditingMeetingId);
                if (existing) {
                    meeting.attachments = existing.attachments || [];
                    // æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®å®Œäº†çŠ¶æ…‹ã‚’ä¿æŒ
                    if (existing.tasks) {
                        tasks.forEach((task, index) => {
                            if (existing.tasks[index] && existing.tasks[index].text === task.text) {
                                task.done = existing.tasks[index].done;
                            }
                        });
                    }
                }
            }
            
            try {
                // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                const contact = contacts.find(c => c.id === currentEditingContactId);
                for (const file of selectedMeetingFiles) {
                    const timestamp = new Date().getTime();
                    const fileName = `${sanitizeFileName(contact.name)}_meeting_${timestamp}_${sanitizeFileName(file.name)}`;
                    const fileResult = await uploadFile(file, fileName);
                    meeting.attachments.push({
                        name: file.name,
                        id: fileResult.id,
                        url: fileResult.url,
                        uploadedAt: new Date().toISOString()
                    });
                }
                
                // å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
                meeting.attachments = meeting.attachments.filter(att => 
                    !deletedMeetingAttachments.includes(att.id)
                );
                
                // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä¿å­˜
                const index = meetings.findIndex(m => m.id === meeting.id);
                if (index >= 0) {
                    meetings[index] = meeting;
                } else {
                    meetings.push(meeting);
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                await saveData();
                
                // ãƒ‰ãƒ©ãƒ•ãƒˆã‚’å‰Šé™¤
                clearDraft();
                
                // UIã‚’æ›´æ–°
                closeModal('meetingFormModal');
                showContactDetail(currentEditingContactId);
                renderContactList();
                renderOutstandingActions();
                
                hideLoading();
                showNotification('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                hideLoading();
            }
        }

        async function deleteMeeting(meetingId) {
            if (!confirm('ã“ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            showLoading();
            
            try {
                // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å‰Šé™¤
                meetings = meetings.filter(m => m.id !== meetingId);
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                await saveData();
                
                // UIã‚’æ›´æ–°
                showContactDetail(currentEditingContactId);
                renderContactList();
                renderOutstandingActions();
                
                hideLoading();
                showNotification('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                hideLoading();
            }
        }

        function editMeeting(meetingId) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (meeting) {
                showMeetingForm(meeting.contactId, meetingId);
            }
        }

        // ===== ã‚¿ã‚¹ã‚¯ç®¡ç† =====
        function displayTaskInputs(tasks = []) {
            const container = document.getElementById('taskInputContainer');
            container.innerHTML = tasks.map((task, index) => `
                <div class="task-input-row">
                    <input type="text" name="taskText[]" value="${escapeHtml(task.text)}" placeholder="ã‚¿ã‚¹ã‚¯å†…å®¹">
                    <input type="datetime-local" name="taskDue[]" value="${task.due ? task.due.slice(0, 16) : ''}" placeholder="æœŸé™">
                    <button type="button" class="btn-small btn-danger" onclick="removeTaskInput(this)">å‰Šé™¤</button>
                </div>
            `).join('');
            
            // ã‚¿ã‚¹ã‚¯ãŒ0å€‹ã®å ´åˆã¯1ã¤è¿½åŠ 
            if (tasks.length === 0) {
                addTaskInput();
            }
            
            container.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(draftSaveTimer);
                    draftSaveTimer = setTimeout(saveDraft, 5000);
                });
            });
        }

        function addTaskInput() {
            const container = document.getElementById('taskInputContainer');
            const newRow = document.createElement('div');
            newRow.className = 'task-input-row';
            newRow.innerHTML = `
                <input type="text" name="taskText[]" placeholder="ã‚¿ã‚¹ã‚¯å†…å®¹">
                <input type="datetime-local" name="taskDue[]" placeholder="æœŸé™">
                <button type="button" class="btn-small btn-danger" onclick="removeTaskInput(this)">å‰Šé™¤</button>
            `;
            container.appendChild(newRow);
            
            newRow.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(draftSaveTimer);
                    draftSaveTimer = setTimeout(saveDraft, 5000);
                });
            });
        }

        function removeTaskInput(button) {
            button.closest('.task-input-row').remove();
            clearTimeout(draftSaveTimer);
            draftSaveTimer = setTimeout(saveDraft, 1000);
        }

        // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ã‚¿ã‚¹ã‚¯è¿½åŠ 
        function addFirstMeetingTask() {
            const container = document.getElementById('firstMeetingTaskContainer');
            const newRow = document.createElement('div');
            newRow.className = 'task-input-row';
            newRow.innerHTML = `
                <input type="text" name="firstTaskText[]" placeholder="ã‚¿ã‚¹ã‚¯å†…å®¹">
                <input type="datetime-local" name="firstTaskDue[]" placeholder="æœŸé™">
                <button type="button" class="btn-small btn-danger" onclick="removeTaskInput(this)">å‰Šé™¤</button>
            `;
            container.appendChild(newRow);
        }

        // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆè¡¨ç¤º
        function renderTaskListNew(meeting) {
            if (!meeting.tasks || meeting.tasks.length === 0) return '';
            
            return `
                <ul class="task-list">
                    ${meeting.tasks.map((task, index) => {
                        const isOverdue = task.due && new Date(task.due) < new Date();
                        return `
                            <li class="task-item ${task.done ? 'completed' : ''}">
                                <input type="checkbox" 
                                       class="task-checkbox"
                                       ${task.done ? 'checked' : ''}
                                       onchange="toggleTaskCompleteNew('${meeting.id}', ${index})">
                                <span class="task-text" 
                                      ondblclick="startTaskEdit('${meeting.id}', ${index})"
                                      id="task-${meeting.id}-${index}">${escapeHtml(task.text)}</span>
                                ${task.due ? 
                                    `<span class="task-due ${isOverdue && !task.done ? 'overdue' : ''}">
                                        ${formatDateTime(task.due)}${isOverdue && !task.done ? ' (æœŸé™åˆ‡ã‚Œ)' : ''}
                                    </span>` : 
                                    ''}
                            </li>
                        `;
                    }).join('')}
                </ul>
            `;
        }

        // ã‚¿ã‚¹ã‚¯ç·¨é›†
        function startTaskEdit(meetingId, taskIndex) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (!meeting || !meeting.tasks[taskIndex] || meeting.tasks[taskIndex].done) return;
            
            const taskElement = document.getElementById(`task-${meetingId}-${taskIndex}`);
            taskElement.contentEditable = true;
            taskElement.classList.add('editing');
            taskElement.focus();
            
            // ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’é¸æŠ
            const range = document.createRange();
            range.selectNodeContents(taskElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ä¿å­˜ã€ESCã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            taskElement.onkeydown = async function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    await saveTaskEdit(meetingId, taskIndex, taskElement.textContent.trim());
                } else if (e.key === 'Escape') {
                    cancelTaskEdit(meetingId, taskIndex);
                }
            };
            
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸã‚‰ä¿å­˜
            taskElement.onblur = async function() {
                await saveTaskEdit(meetingId, taskIndex, taskElement.textContent.trim());
            };
        }

        async function saveTaskEdit(meetingId, taskIndex, newText) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (!meeting || !meeting.tasks[taskIndex]) return;
            
            if (newText && newText !== meeting.tasks[taskIndex].text) {
                meeting.tasks[taskIndex].text = newText;
                meeting.updatedAt = new Date().toISOString();
                
                try {
                    await saveData();
                    showNotification('ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                    // è©³ç´°ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
                    if (currentEditingContactId === meeting.contactId) {
                        showContactDetail(meeting.contactId);
                    }
                    renderOutstandingActions();
                } catch (error) {
                    showNotification('ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } else {
                cancelTaskEdit(meetingId, taskIndex);
            }
        }

        function cancelTaskEdit(meetingId, taskIndex) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (!meeting || !meeting.tasks[taskIndex]) return;
            
            const taskElement = document.getElementById(`task-${meetingId}-${taskIndex}`);
            taskElement.contentEditable = false;
            taskElement.classList.remove('editing');
            taskElement.textContent = meeting.tasks[taskIndex].text;
            taskElement.onkeydown = null;
            taskElement.onblur = null;
        }

        async function toggleTaskCompleteNew(meetingId, taskIndex) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (!meeting || !meeting.tasks[taskIndex]) return;
            
            meeting.tasks[taskIndex].done = !meeting.tasks[taskIndex].done;
            meeting.updatedAt = new Date().toISOString();
            
            try {
                await saveData();
                renderOutstandingActions();
                // è©³ç´°ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
                if (currentEditingContactId === meeting.contactId) {
                    showContactDetail(meeting.contactId);
                }
                renderContactList();
                showNotification('ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯å…ƒã«æˆ»ã™
                meeting.tasks[taskIndex].done = !meeting.tasks[taskIndex].done;
                showNotification('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ===== ãƒ‰ãƒ©ãƒ•ãƒˆç®¡ç† =====
        function saveDraft() {
            const meetingForm = document.getElementById('meetingForm');
            if (!meetingForm || meetingForm.style.display === 'none') return;
            
            const content = meetingForm.content.value;
            const taskTexts = Array.from(meetingForm.querySelectorAll('input[name="taskText[]"]')).map(input => input.value);
            const taskDues = Array.from(meetingForm.querySelectorAll('input[name="taskDue[]"]')).map(input => input.value);
            
            if (content || taskTexts.some(text => text)) {
                const draftKey = currentEditingMeetingId ? 
                    `draft_meeting_${currentEditingMeetingId}` : 
                    `draft_meeting_${currentEditingContactId || 'new'}`;
                
                const draftData = {
                    content: content,
                    datetime: meetingForm.datetime.value,
                    tasks: taskTexts.map((text, index) => ({
                        text: text,
                        due: taskDues[index]
                    })).filter(task => task.text),
                    timestamp: new Date().toISOString()
                };
                
                sessionStorage.setItem(draftKey, JSON.stringify(draftData));
                hasUnsavedDraft = true;
                
                // ãƒ‰ãƒ©ãƒ•ãƒˆä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤º
                const indicator = document.getElementById('draftStatus');
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }
        }

        function restoreDraft() {
            const draftKey = currentEditingMeetingId ? 
                `draft_meeting_${currentEditingMeetingId}` : 
                `draft_meeting_${currentEditingContactId || 'new'}`;
            
            const draftData = sessionStorage.getItem(draftKey);
            if (draftData) {
                const draft = JSON.parse(draftData);
                const form = document.getElementById('meetingForm');
                
                // ãƒ‰ãƒ©ãƒ•ãƒˆãŒç¾åœ¨ã®å†…å®¹ã‚ˆã‚Šæ–°ã—ã„å ´åˆã®ã¿å¾©å…ƒ
                if (!form.content.value || confirm('ä¿å­˜ã•ã‚Œã¦ã„ãªã„ä¸‹æ›¸ããŒã‚ã‚Šã¾ã™ã€‚å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ')) {
                    form.content.value = draft.content;
                    if (draft.datetime) form.datetime.value = draft.datetime;
                    
                    // ã‚¿ã‚¹ã‚¯ã‚’å¾©å…ƒ
                    if (draft.tasks && draft.tasks.length > 0) {
                        displayTaskInputs(draft.tasks);
                    }
                    
                    showNotification('ä¸‹æ›¸ãã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                }
            }
        }

        function clearDraft() {
            const draftKey = currentEditingMeetingId ? 
                `draft_meeting_${currentEditingMeetingId}` : 
                `draft_meeting_${currentEditingContactId || 'new'}`;
            
            sessionStorage.removeItem(draftKey);
            hasUnsavedDraft = false;
        }

        // ===== UIè¡¨ç¤º =====
        function showContactDetail(contactId) {
            const contact = contacts.find(c => c.id === contactId);
            if (!contact) return;
            
            const contactMeetings = meetings.filter(m => m.contactId === contactId)
                .sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
            
            let html = `
                <div style="margin-bottom: 20px;">
                    ${contact.photoUrl ? 
                        `<div class="contact-photo" style="width: 120px; height: 120px; margin-bottom: 20px;">
                            <img src="${contact.photoUrl}" alt="${contact.name}" loading="lazy" onerror="handleImageError(this, '${escapeHtml(contact.name)}')">
                        </div>` : ''}
                    <h3 style="font-size: 24px; margin-bottom: 10px;">${escapeHtml(contact.name)}</h3>
                    ${contact.yomi ? `<p style="color: #aaaaaa; margin-bottom: 10px;">ã‚ˆã¿: ${escapeHtml(contact.yomi)}</p>` : ''}
                    ${contact.company ? `<p style="color: #aaaaaa; margin-bottom: 20px;">${escapeHtml(contact.company)}</p>` : ''}
                </div>
                
                <div class="detail-tabs">
                    <button class="detail-tab active" onclick="switchTab(event, 'basic')">åŸºæœ¬æƒ…å ±</button>
                    <button class="detail-tab" onclick="switchTab(event, 'strength')">å¼·ã¿ãƒ»çµŒæ­´</button>
                    <button class="detail-tab" onclick="switchTab(event, 'files')">ãƒ•ã‚¡ã‚¤ãƒ«</button>
                </div>
                
                <div id="basic" class="tab-content active">
                    <div class="tab-panel">
                        <table style="width: 100%; margin-bottom: 20px;">
                            ${contact.email ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">ãƒ¡ãƒ¼ãƒ«:</td><td style="padding: 8px 0;">${linkifyText(escapeHtml(contact.email))}</td></tr>` : ''}
                            ${contact.phone ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">é›»è©±:</td><td style="padding: 8px 0;">${escapeHtml(contact.phone)}</td></tr>` : ''}
                            ${contact.homepage ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">HP:</td><td style="padding: 8px 0;">${linkifyText(escapeHtml(contact.homepage))}</td></tr>` : ''}
                            ${contact.area ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">ã‚¨ãƒªã‚¢:</td><td style="padding: 8px 0;">${escapeHtml(contact.area)}</td></tr>` : ''}
                            ${contact.residence ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">å±…ä½åœ°:</td><td style="padding: 8px 0;">${escapeHtml(contact.residence)}</td></tr>` : ''}
                            ${contact.referredBy ? `<tr><td style="padding: 8px 0; color: #aaaaaa;">ç´¹ä»‹å…ƒ:</td><td style="padding: 8px 0;">${getReferrerDisplay(contact)}</td></tr>` : ''}
                        </table>
                        
                        ${contact.types && contact.types.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <strong>ç¨®åˆ¥:</strong> ${contact.types.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join(' ')}
                            </div>
                        ` : ''}
                        
                        ${contact.affiliations && contact.affiliations.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <strong>æ‰€å±ãƒ»ãƒãƒ£ãƒ—ã‚¿ãƒ¼:</strong> ${contact.affiliations.map(a => `<span class="tag">${escapeHtml(a)}</span>`).join(' ')}
                            </div>
                        ` : ''}
                        
                        ${contact.wantToConnect && contact.wantToConnect.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <strong>ç¹‹ãŒã‚ŠãŸã„äººãƒ»æ¥­ç¨®:</strong> ${contact.wantToConnect.map(w => `<span class="tag">${escapeHtml(w)}</span>`).join(' ')}
                            </div>
                        ` : ''}
                        
                        ${contact.goldenEgg && contact.goldenEgg.length > 0 ? `
                            <div style="margin-bottom: 15px;">
                                <strong>é‡‘ã®åµ:</strong> ${contact.goldenEgg.map(g => `<span class="tag">${escapeHtml(g)}</span>`).join(' ')}
                            </div>
                        ` : ''}
                        
                        ${contact.cutout ? `
                            <div style="margin-bottom: 15px;">
                                <strong>åˆ‡ã‚Šå‡ºã—æ–¹:</strong>
                                <div class="markdown">${renderMarkdown(contact.cutout)}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div id="strength" class="tab-content">
                    <div class="tab-panel">
                        ${contact.strengths ? `
                            <div style="margin-bottom: 20px;">
                                <strong>å¼·ã¿:</strong>
                                <div class="collapsible-content ${contact.strengths.length > 500 ? 'collapsed' : ''}" id="strengths-${contact.id}">
                                    <div class="markdown">${renderMarkdown(contact.strengths)}</div>
                                </div>
                                ${contact.strengths.length > 500 ? `
                                    <a href="#" class="toggle-link" onclick="toggleCollapsible('strengths-${contact.id}'); return false;">ç¶šãã‚’èª­ã‚€</a>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${contact.careerHistory ? `
                            <div>
                                <strong>éå»ã®çµŒæ­´:</strong>
                                <div class="collapsible-content ${contact.careerHistory.length > 500 ? 'collapsed' : ''}" id="career-${contact.id}">
                                    <div class="markdown">${renderMarkdown(contact.careerHistory)}</div>
                                </div>
                                ${contact.careerHistory.length > 500 ? `
                                    <a href="#" class="toggle-link" onclick="toggleCollapsible('career-${contact.id}'); return false;">ç¶šãã‚’èª­ã‚€</a>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${!contact.strengths && !contact.careerHistory ? 
                            '<p style="color: #aaaaaa;">ã¾ã æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>' : ''}
                    </div>
                </div>
                
                <div id="files" class="tab-content">
                    <div class="tab-panel">
                        ${contact.cardImageUrl ? `
                            <div style="margin-bottom: 20px;">
                                <strong>ååˆºç”»åƒ:</strong>
                                <div style="margin-top: 10px;">
                                    <img src="${contact.cardImageUrl}" style="max-width: 100%; border-radius: 8px; cursor: pointer;" 
                                         onclick="window.open('${contact.cardImageUrl}', '_blank')"
                                         loading="lazy"
                                         onerror="handleImageError(this, 'ååˆº')">
                                </div>
                            </div>
                        ` : ''}
                        
                        ${contact.attachments && contact.attachments.length > 0 ? `
                            <div>
                                <strong>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:</strong>
                                <div class="file-list" style="margin-top: 10px;">
                                    ${contact.attachments.map(att => `
                                        <div class="file-item">
                                            <span>${escapeHtml(att.name)}</span>
                                            <a href="#" onclick="openFile('${att.url}', '${escapeHtml(att.name)}'); return false;" class="btn-small btn-secondary">é–‹ã</a>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${!contact.cardImageUrl && (!contact.attachments || contact.attachments.length === 0) ?
                            '<p style="color: #aaaaaa;">ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>' : ''}
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn-primary" onclick="showContactForm('${contact.id}')">ç·¨é›†</button>
                    <button class="btn-secondary" onclick="showMeetingForm('${contact.id}')">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²è¿½åŠ </button>
                    <button class="btn-danger" onclick="deleteContact('${contact.id}')">å‰Šé™¤</button>
                </div>
                
                <div class="meeting-timeline">
                    <h3 style="margin-bottom: 20px;">ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¥æ­´</h3>
                    ${contactMeetings.length > 0 ? 
                        renderMeetingHistory(contactMeetings) : 
                        '<p style="color: #aaaaaa;">ã¾ã ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>'
                    }
                </div>
            `;
            
            currentEditingContactId = contactId;
            document.getElementById('contactDetailBody').innerHTML = html;
            document.getElementById('contactDetailModal').style.display = 'block';
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’æœ€ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.querySelector('#contactDetailModal .modal-content').scrollTop = 0;
        }

        function renderMeetingHistory(meetings) {
            return meetings.map(meeting => `
                <div class="meeting-card">
                    <div class="meeting-card-header">
                        <div class="meeting-card-date">${formatDateTime(meeting.datetime)}</div>
                        <div class="meeting-card-actions">
                            <button class="btn-small btn-secondary" onclick="editMeeting('${meeting.id}')">ç·¨é›†</button>
                            <button class="btn-small btn-danger" onclick="deleteMeeting('${meeting.id}')">å‰Šé™¤</button>
                        </div>
                    </div>
                    <div class="markdown-content ${meeting.content.length > 500 ? 'truncated' : ''}" id="content-${meeting.id}">
                        ${renderMarkdown(meeting.content)}
                    </div>
                    ${meeting.content.length > 500 ? `
                        <a href="#" class="read-more" onclick="toggleContent('${meeting.id}'); return false;">ç¶šãã‚’èª­ã‚€</a>
                    ` : ''}
                    ${meeting.tasks && meeting.tasks.length > 0 ? `
                        <div class="meeting-tasks">
                            <strong>æ¬¡å›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:</strong>
                            ${renderTaskListNew(meeting)}
                        </div>
                    ` : ''}
                    ${meeting.attachments && meeting.attachments.length > 0 ? `
                        <div style="margin-top: 10px;">
                            <strong>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:</strong>
                            ${meeting.attachments.map(att => `
                                <a href="#" onclick="openFile('${att.url}', '${escapeHtml(att.name)}'); return false;" style="margin-left: 10px;">${escapeHtml(att.name)}</a>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderContactList(filterFunc = null) {
            const grid = document.getElementById('contactGrid');
            let filteredContacts = filterFunc ? contacts.filter(filterFunc) : contacts;
            
            // ã‚½ãƒ¼ãƒˆé©ç”¨
            filteredContacts = sortContacts(filteredContacts);
            
            // æœªå®Œäº†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’æ›´æ–°
            const outstandingCount = getOutstandingTaskCount();
            const actionsHeader = document.querySelector('#outstandingActions h3');
            if (actionsHeader) {
                actionsHeader.textContent = `æœªå®Œäº†ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³${outstandingCount > 0 ? ' (' + outstandingCount + ')' : ''}`;
            }
            
            if (viewMode === 'list') {
                // ãƒªã‚¹ãƒˆè¡¨ç¤º
                grid.className = 'contact-list';
                grid.innerHTML = filteredContacts.map(contact => {
                    const lastMeetingDate = getLastMeetingDate(contact.id);
                    const lastMeetingText = lastMeetingDate ? 
                        `æœ€çµ‚: ${formatDate(lastMeetingDate)}` : 
                        'æœªå®Ÿæ–½';
                    
                    return `
                        <div class="contact-list-item" onclick="handleContactClick(event, '${contact.id}')">
                            <div class="contact-list-photo">
                                ${contact.photoUrl ? 
                                    `<img src="${contact.photoUrl}" alt="${contact.name}" loading="lazy" onerror="handleImageError(this, '${escapeHtml(contact.name)}')">` : 
                                    `<span style="font-size: 20px;">${contact.name.charAt(0)}</span>`
                                }
                            </div>
                            <div class="contact-list-info">
                                <div class="contact-list-name">
                                    ${escapeHtml(contact.name)}
                                    ${contact.yomi ? `<span style="font-size: 12px; color: #888;">ï¼ˆ${escapeHtml(contact.yomi)}ï¼‰</span>` : ''}
                                </div>
                                <div class="contact-list-company">${contact.company || 'ãƒ¼'}</div>
                                <div style="display: flex; gap: 10px; margin-top: 4px;">
                                    ${contact.email ? `<a href="mailto:${contact.email}" onclick="event.stopPropagation()" style="font-size: 13px;">ğŸ“§</a>` : ''}
                                    ${contact.homepage ? `<a href="${contact.homepage}" target="_blank" onclick="event.stopPropagation()" style="font-size: 13px;">ğŸŒ</a>` : ''}
                                </div>
                            </div>
                            <div class="contact-list-meeting">${lastMeetingText}</div>
                        </div>
                    `;
                }).join('');
            } else {
                // ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
                grid.className = 'contact-grid';
                grid.innerHTML = filteredContacts.map(contact => {
                    const lastMeetingDate = getLastMeetingDate(contact.id);
                    const lastMeetingText = lastMeetingDate ? 
                        `æœ€çµ‚æ‰“åˆã›: ${formatDate(lastMeetingDate)}` : 
                        'ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°æœªå®Ÿæ–½';
                    
                    return `
                        <div class="contact-card" onclick="handleContactClick(event, '${contact.id}')">
                            <div class="contact-photo">
                                ${contact.photoUrl ? 
                                    `<img src="${contact.photoUrl}" alt="${contact.name}" loading="lazy" onerror="handleImageError(this, '${escapeHtml(contact.name)}')">` : 
                                    `<span style="font-size: 32px;">${contact.name.charAt(0)}</span>`
                                }
                            </div>
                            <div class="contact-name">${escapeHtml(contact.name)}</div>
                            ${contact.yomi ? `<div class="contact-info" style="font-size: 12px; color: #888;">ï¼ˆ${escapeHtml(contact.yomi)}ï¼‰</div>` : ''}
                            ${contact.company ? `<div class="contact-info">ä¼šç¤¾: ${escapeHtml(contact.company)}</div>` : ''}
                            ${contact.email ? `<div class="contact-info"><a href="mailto:${contact.email}" onclick="event.stopPropagation()">ğŸ“§ ${escapeHtml(contact.email)}</a></div>` : ''}
                            ${contact.phone ? `<div class="contact-info">ğŸ“± ${escapeHtml(contact.phone)}</div>` : ''}
                            ${contact.homepage ? `<div class="contact-info"><a href="${contact.homepage}" target="_blank" onclick="event.stopPropagation()">ğŸŒ ${escapeHtml(contact.homepage)}</a></div>` : ''}
                            <div class="last-meeting-info">${lastMeetingText}</div>
                            <div class="tags">
                                ${(contact.types || []).map(type => `<span class="tag">${escapeHtml(type)}</span>`).join('')}
                                ${(contact.affiliations || []).map(aff => `<span class="tag">${escapeHtml(aff)}</span>`).join('')}
                                ${contact.referredBy ? `<span class="tag">ç´¹ä»‹: ${escapeHtml(contact.referredBy)}</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ===== æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆ =====
        function filterContacts() {
            const searchText = document.getElementById('searchName').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const affiliationFilter = document.getElementById('filterAffiliation').value;
            const wantToConnectFilter = document.getElementById('filterWantToConnect').value;
            const goldenEggFilter = document.getElementById('filterGoldenEgg').value;
            const referredByFilter = document.getElementById('filterReferredBy').value;
            const areaFilter = document.getElementById('filterArea').value;
            const residenceFilter = document.getElementById('filterResidence').value;

            renderContactList(contact => {
                // ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
                if (searchText) {
                    const searchableText = [
                        contact.name,
                        contact.yomi,
                        contact.company,
                        contact.email,
                        contact.phone,
                        contact.homepage,
                        contact.strengths,
                        contact.referredBy,
                        contact.careerHistory,
                        contact.cutout,
                        contact.area,
                        contact.residence,
                        ...(contact.types || []),
                        ...(contact.affiliations || []),
                        ...(contact.goldenEgg || []),
                        ...(contact.wantToConnect || [])
                    ].filter(Boolean).join(' ').toLowerCase();
                    
                    // é–¢é€£ã™ã‚‹ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å†…å®¹ã‚‚æ¤œç´¢å¯¾è±¡ã«å«ã‚ã‚‹
                    const contactMeetings = meetings.filter(m => m.contactId === contact.id);
                    const meetingText = contactMeetings.map(m => {
                        const taskTexts = m.tasks ? m.tasks.map(t => t.text).join(' ') : '';
                        return [m.content, taskTexts].filter(Boolean).join(' ');
                    }).join(' ').toLowerCase();
                    
                    const fullText = searchableText + ' ' + meetingText;
                    
                    if (!fullText.includes(searchText)) return false;
                }
                
                // å€‹åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (typeFilter && !(contact.types || []).includes(typeFilter)) return false;
                if (affiliationFilter && !(contact.affiliations || []).includes(affiliationFilter)) return false;
                if (wantToConnectFilter && !(contact.wantToConnect || []).includes(wantToConnectFilter)) return false;
                if (goldenEggFilter && !(contact.goldenEgg || []).includes(goldenEggFilter)) return false;
                if (referredByFilter && contact.referredBy !== referredByFilter) return false;
                if (areaFilter && contact.area !== areaFilter) return false;
                if (residenceFilter && contact.residence !== residenceFilter) return false;
                
                return true;
            });
        }

        function applySorting() {
            currentSortOrder = document.getElementById('sortOrder').value;
            renderContactList();
        }

        function sortContacts(contactList) {
            const sorted = [...contactList];
            
            switch (currentSortOrder) {
                case 'meeting-desc':
                    sorted.sort((a, b) => {
                        const dateA = getLastMeetingDate(a.id);
                        const dateB = getLastMeetingDate(b.id);
                        if (!dateA && !dateB) return 0;
                        if (!dateA) return 1;
                        if (!dateB) return -1;
                        return dateB - dateA;
                    });
                    break;
                case 'meeting-asc':
                    sorted.sort((a, b) => {
                        const dateA = getLastMeetingDate(a.id);
                        const dateB = getLastMeetingDate(b.id);
                        if (!dateA && !dateB) return 0;
                        if (!dateA) return 1;
                        if (!dateB) return -1;
                        return dateA - dateB;
                    });
                    break;
                case 'name-asc':
                    sorted.sort((a, b) => a.name.localeCompare(b.name, 'ja'));
                    break;
                case 'name-desc':
                    sorted.sort((a, b) => b.name.localeCompare(a.name, 'ja'));
                    break;
                case 'yomi-asc':
                    sorted.sort((a, b) => {
                        const yomiA = a.yomi || a.name;
                        const yomiB = b.yomi || b.name;
                        return yomiA.localeCompare(yomiB, 'ja');
                    });
                    break;
                case 'yomi-desc':
                    sorted.sort((a, b) => {
                        const yomiA = a.yomi || a.name;
                        const yomiB = b.yomi || b.name;
                        return yomiB.localeCompare(yomiA, 'ja');
                    });
                    break;
            }
            
            return sorted;
        }

        function getLastMeetingDate(contactId) {
            const contactMeetings = meetings.filter(m => m.contactId === contactId);
            if (contactMeetings.length === 0) return null;
            
            return contactMeetings
                .map(m => new Date(m.datetime))
                .sort((a, b) => b - a)[0];
        }

        // ===== æœªå®Œäº†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† =====
        function toggleOutstandingActions() {
            const list = document.getElementById('outstandingActionsList');
            const toggleText = document.getElementById('toggleActionsText');
            
            if (list.style.display === 'none') {
                list.style.display = 'block';
                toggleText.textContent = 'éè¡¨ç¤º';
                renderOutstandingActions();
            } else {
                list.style.display = 'none';
                toggleText.textContent = 'è¡¨ç¤º';
            }
        }

        function renderOutstandingActions() {
            const outstandingTasks = [];
            
            // ã™ã¹ã¦ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‹ã‚‰æœªå®Œäº†ã‚¿ã‚¹ã‚¯ã‚’åé›†
            meetings.forEach(meeting => {
                if (meeting.tasks && meeting.tasks.length > 0) {
                    meeting.tasks.forEach((task, index) => {
                        if (!task.done) {
                            const contact = contacts.find(c => c.id === meeting.contactId);
                            outstandingTasks.push({
                                meeting: meeting,
                                contact: contact,
                                task: task,
                                taskIndex: index,
                                isOverdue: task.due && new Date(task.due) < new Date()
                            });
                        }
                    });
                }
            });
            
            // æœŸé™ã§ã‚½ãƒ¼ãƒˆ
            outstandingTasks.sort((a, b) => {
                if (a.task.due && b.task.due) {
                    return new Date(a.task.due) - new Date(b.task.due);
                }
                if (a.task.due) return -1;
                if (b.task.due) return 1;
                return new Date(b.meeting.createdAt) - new Date(a.meeting.createdAt);
            });
            
            const container = document.getElementById('outstandingActionsList');
            
            if (outstandingTasks.length === 0) {
                container.innerHTML = '<p style="color: #aaaaaa;">æœªå®Œäº†ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            const html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid #444;">
                            <th style="text-align: left; padding: 8px;">é€£çµ¡å…ˆ</th>
                            <th style="text-align: left; padding: 8px;">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹</th>
                            <th style="text-align: left; padding: 8px;">æœŸé™</th>
                            <th style="text-align: center; padding: 8px;">å®Œäº†</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${outstandingTasks.map(item => `
                            <tr>
                                <td style="padding: 8px;">
                                    <a href="#" onclick="showContactDetail('${item.contact.id}'); return false;">
                                        ${escapeHtml(item.contact.name)}
                                    </a>
                                </td>
                                <td style="padding: 8px; max-width: 400px;">
                                    <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                         ondblclick="startTaskEdit('${item.meeting.id}', ${item.taskIndex})"
                                         id="task-${item.meeting.id}-${item.taskIndex}">
                                        ${escapeHtml(item.task.text)}
                                    </div>
                                </td>
                                <td style="padding: 8px; ${item.isOverdue ? 'color: #d93025;' : ''}">
                                    ${item.task.due ? formatDateTime(item.task.due) : '-'}
                                </td>
                                <td style="padding: 8px; text-align: center;">
                                    <input type="checkbox" 
                                           onchange="toggleTaskCompleteNew('${item.meeting.id}', ${item.taskIndex})"
                                           style="cursor: pointer; width: 18px; height: 18px;">
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        function getOutstandingTaskCount() {
            let count = 0;
            meetings.forEach(meeting => {
                if (meeting.tasks && meeting.tasks.length > 0) {
                    meeting.tasks.forEach(task => {
                        if (!task.done) {
                            count++;
                        }
                    });
                }
            });
            return count;
        }

        // ===== ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† =====
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processPhotoFile(file);
            }
        }

        function processPhotoFile(file) {
            if (!file.type.startsWith('image/')) {
                showNotification('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            currentPhotoFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photoPreview').innerHTML = 
                    `<img src="${e.target.result}" style="max-width: 200px; margin-top: 10px; border-radius: 8px;">`;
            };
            reader.readAsDataURL(file);
        }

        function handleCardImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processCardImageFile(file);
            }
        }

        function processCardImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showNotification('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            currentCardImageFile = file;
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('cardImagePreview').innerHTML = 
                    `<img src="${e.target.result}" style="max-width: 100%; margin-top: 10px; border-radius: 8px;">`;
            };
            reader.readAsDataURL(file);
        }

        function setupFileDragDrop() {
            // é¡”å†™çœŸ
            const photoZone = document.getElementById('photoDropZone');
            const photoInput = document.getElementById('photoUpload');
            
            if (photoZone && photoInput) {
                photoZone.addEventListener('click', () => photoInput.click());
                photoZone.addEventListener('dragover', handleDragOver);
                photoZone.addEventListener('dragleave', handleDragLeave);
                photoZone.addEventListener('drop', (e) => handlePhotoDrop(e));
            }
            
            // ååˆºç”»åƒ
            setupCardImageInput();
            
            // é€£çµ¡å…ˆã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
            const attachmentZone = document.getElementById('attachmentDropZone');
            const attachmentInput = document.getElementById('attachmentUpload');
            
            if (attachmentZone && attachmentInput) {
                attachmentZone.addEventListener('click', () => attachmentInput.click());
                attachmentZone.addEventListener('dragover', handleDragOver);
                attachmentZone.addEventListener('dragleave', handleDragLeave);
                attachmentZone.addEventListener('drop', (e) => handleDrop(e, 'contact'));
                attachmentInput.addEventListener('change', (e) => handleFileSelect(e, 'contact'));
            }
            
            // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
            const meetingZone = document.getElementById('meetingAttachmentDropZone');
            const meetingInput = document.getElementById('meetingAttachmentUpload');
            
            if (meetingZone && meetingInput) {
                meetingZone.addEventListener('click', () => meetingInput.click());
                meetingZone.addEventListener('dragover', handleDragOver);
                meetingZone.addEventListener('dragleave', handleDragLeave);
                meetingZone.addEventListener('drop', (e) => handleDrop(e, 'meeting'));
                meetingInput.addEventListener('change', (e) => handleFileSelect(e, 'meeting'));
            }
        }

        function setupCardImageInput() {
            const cardImageZone = document.getElementById('cardImageDropZone');
            const cardImageInput = document.getElementById('cardImageUpload');
            
            if (!cardImageZone || !cardImageInput) return;
            
            // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯captureå±æ€§ã‚’è¿½åŠ 
            if (window.matchMedia("(max-width: 768px)").matches) {
                cardImageInput.setAttribute('capture', 'camera');
            }
            
            cardImageZone.addEventListener('click', () => cardImageInput.click());
            cardImageZone.addEventListener('dragover', handleDragOver);
            cardImageZone.addEventListener('dragleave', handleDragLeave);
            cardImageZone.addEventListener('drop', (e) => handleCardImageDrop(e));
        }

        function setupFirstMeetingFileDrop() {
            const dropZone = document.getElementById('firstMeetingAttachmentDropZone');
            const fileInput = document.getElementById('firstMeetingAttachmentUpload');
            
            if (!dropZone || !fileInput) return;
            
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', (e) => handleFirstMeetingDrop(e));
            fileInput.addEventListener('change', (e) => handleFirstMeetingFileSelect(e));
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handlePhotoDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                processPhotoFile(files[0]);
            }
        }

        function handleCardImageDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                processCardImageFile(files[0]);
            }
        }

        function handleDrop(e, type) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            if (type === 'contact') {
                selectedFiles.push(...files);
                displayNewAttachments();
            } else {
                selectedMeetingFiles.push(...files);
                displayNewMeetingAttachments();
            }
        }

        function handleFileSelect(e, type) {
            const files = Array.from(e.target.files);
            if (type === 'contact') {
                selectedFiles.push(...files);
                displayNewAttachments();
            } else {
                selectedMeetingFiles.push(...files);
                displayNewMeetingAttachments();
            }
        }

        function handleFirstMeetingDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            selectedFirstMeetingFiles.push(...files);
            displayFirstMeetingAttachments();
        }

        function handleFirstMeetingFileSelect(e) {
            const files = Array.from(e.target.files);
            selectedFirstMeetingFiles.push(...files);
            displayFirstMeetingAttachments();
        }

        function displayExistingAttachments(attachments) {
            const container = document.getElementById('existingAttachments');
            container.innerHTML = attachments.map(att => `
                <div class="file-item">
                    <span>${escapeHtml(att.name)}</span>
                    <div class="file-item-actions">
                        <a href="#" onclick="openFile('${att.url}', '${escapeHtml(att.name)}'); return false;" class="btn-small btn-secondary">é–‹ã</a>
                        <button type="button" class="btn-small btn-danger" onclick="markAttachmentForDeletion('${att.id}')">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function displayExistingMeetingAttachments(attachments) {
            const container = document.getElementById('existingMeetingAttachments');
            container.innerHTML = attachments.map(att => `
                <div class="file-item">
                    <span>${escapeHtml(att.name)}</span>
                    <div class="file-item-actions">
                        <a href="#" onclick="openFile('${att.url}', '${escapeHtml(att.name)}'); return false;" class="btn-small btn-secondary">é–‹ã</a>
                        <button type="button" class="btn-small btn-danger" onclick="markMeetingAttachmentForDeletion('${att.id}')">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function displayNewAttachments() {
            const container = document.getElementById('newAttachments');
            container.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <span>${escapeHtml(file.name)}</span>
                    <button type="button" class="btn-small btn-danger" onclick="removeNewAttachment(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        function displayNewMeetingAttachments() {
            const container = document.getElementById('newMeetingAttachments');
            container.innerHTML = selectedMeetingFiles.map((file, index) => `
                <div class="file-item">
                    <span>${escapeHtml(file.name)}</span>
                    <button type="button" class="btn-small btn-danger" onclick="removeNewMeetingAttachment(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        function displayFirstMeetingAttachments() {
            const container = document.getElementById('firstMeetingAttachments');
            container.innerHTML = selectedFirstMeetingFiles.map((file, index) => `
                <div class="file-item">
                    <span>${escapeHtml(file.name)}</span>
                    <button type="button" class="btn-small btn-danger" onclick="removeFirstMeetingAttachment(${index})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        function markAttachmentForDeletion(fileId) {
            deletedAttachments.push(fileId);
            event.target.closest('.file-item').style.display = 'none';
        }

        function markMeetingAttachmentForDeletion(fileId) {
            deletedMeetingAttachments.push(fileId);
            event.target.closest('.file-item').style.display = 'none';
        }

        function removeNewAttachment(index) {
            selectedFiles.splice(index, 1);
            displayNewAttachments();
        }

        function removeNewMeetingAttachment(index) {
            selectedMeetingFiles.splice(index, 1);
            displayNewMeetingAttachments();
        }

        function removeFirstMeetingAttachment(index) {
            selectedFirstMeetingFiles.splice(index, 1);
            displayFirstMeetingAttachments();
        }

        function openFile(url, filename) {
            const extension = filename.split('.').pop().toLowerCase();
            const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'];
            const pdfExtensions = ['pdf'];
            const textExtensions = ['txt', 'md', 'csv', 'log'];
            
            if (imageExtensions.includes(extension) || pdfExtensions.includes(extension) || textExtensions.includes(extension)) {
                // ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
                window.open(url, '_blank');
            } else {
                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.target = '_blank';
                a.click();
            }
        }

        // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° =====
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(date) {
            const d = new Date(date);
            return `${d.getFullYear()}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getDate().toString().padStart(2, '0')}`;
        }

        function formatDateTime(datetime) {
            const d = new Date(datetime);
            return `${formatDate(d)} ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
        }

        function sanitizeFileName(fileName) {
            // Google Driveã§ä½¿ç”¨ã§ããªã„æ–‡å­—ã‚’ç½®æ›
            return fileName.replace(/[\/\\:?*<>|"]/g, '_');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error-notification' : ''}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function closeModal(modalId) {
            if (modalId === 'meetingFormModal' && hasUnsavedDraft) {
                if (!confirm('ä¿å­˜ã•ã‚Œã¦ã„ãªã„ä¸‹æ›¸ããŒã‚ã‚Šã¾ã™ã€‚é–‰ã˜ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    return;
                }
            }
            
            document.getElementById(modalId).style.display = 'none';
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (draftSaveTimer) {
                clearTimeout(draftSaveTimer);
                draftSaveTimer = null;
            }
        }

        function updateConnectionStatus() {
            const dot = document.getElementById('connectionDot');
            const tooltip = document.getElementById('connectionTooltip');
            
            if (accessToken) {
                dot.classList.add('connected');
                dot.classList.remove('disconnected');
                tooltip.textContent = 'æ¥ç¶šæ¸ˆã¿';
            } else {
                dot.classList.remove('connected');
                dot.classList.add('disconnected');
                tooltip.textContent = 'æœªæ¥ç¶š';
            }
        }

        function showSettingsModal() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function setViewMode(mode) {
            viewMode = mode;
            localStorage.setItem('viewMode', mode);
            
            saveOptions();
            
            if (mode === 'card') {
                document.getElementById('cardViewBtn').classList.add('active');
                document.getElementById('listViewBtn').classList.remove('active');
            } else {
                document.getElementById('listViewBtn').classList.add('active');
                document.getElementById('cardViewBtn').classList.remove('active');
            }
            
            renderContactList();
        }

        function toggleFilters() {
            const filterContent = document.getElementById('filterContent');
            const toggleIcon = document.getElementById('filterToggleIcon');
            
            filterVisible = !filterVisible;
            localStorage.setItem('filterVisible', filterVisible);
            
            saveOptions();
            
            if (filterVisible) {
                filterContent.classList.add('show');
                toggleIcon.textContent = 'â–¼';
            } else {
                filterContent.classList.remove('show');
                toggleIcon.textContent = 'â–¶';
            }
        }

        function switchTab(event, tabName) {
            const tabs = document.querySelectorAll('.detail-tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function toggleContent(meetingId) {
            const content = document.getElementById(`content-${meetingId}`);
            const link = event.target;
            
            if (content.classList.contains('truncated')) {
                content.classList.remove('truncated');
                link.textContent = 'æŠ˜ã‚ŠãŸãŸã‚€';
            } else {
                content.classList.add('truncated');
                link.textContent = 'ç¶šãã‚’èª­ã‚€';
            }
        }

        function toggleCollapsible(elementId) {
            const element = document.getElementById(elementId);
            const link = event.target;
            
            if (element.classList.contains('collapsed')) {
                element.classList.remove('collapsed');
                link.textContent = 'é–‰ã˜ã‚‹';
            } else {
                element.classList.add('collapsed');
                link.textContent = 'ç¶šãã‚’èª­ã‚€';
            }
        }

        function handleContactClick(event, contactId) {
            // ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (event.target.tagName === 'A') {
                return;
            }
            showContactDetail(contactId);
        }

        function handleImageError(img, contactName) {
            console.error('ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', {
                url: img.src,
                name: contactName,
                error: 'ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'
            });
            
            // ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«è¡¨ç¤ºã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const parentDiv = img.parentElement;
            parentDiv.innerHTML = `<span style="font-size: ${parentDiv.style.width === '120px' ? '48px' : '32px'};">${contactName.charAt(0)}</span>`;
        }

        // ===== Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° =====
        function renderMarkdown(text) {
            if (!text) return '';
            
            // æœ€åˆã«URLã¨ãƒ¡ãƒ¼ãƒ«ã‚’ãƒªãƒ³ã‚¯åŒ–
            text = linkifyText(text);
            
            // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸€æ™‚çš„ã«ç½®æ›
            const codeBlocks = [];
            let processedText = text.replace(/```([\s\S]*?)```/g, (match, code) => {
                codeBlocks.push(`<pre><code>${escapeHtml(code.trim())}</code></pre>`);
                return `__CODEBLOCK_${codeBlocks.length - 1}__`;
            });
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å‡¦ç†
            processedText = processedText.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // è¦‹å‡ºã—
            processedText = processedText.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            processedText = processedText.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            processedText = processedText.replace(/^# (.+)$/gm, '<h1>$1</h1>');
            
            // å¤ªå­—
            processedText = processedText.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // ãƒªãƒ³ã‚¯ï¼ˆMarkdownå½¢å¼ï¼‰
            processedText = processedText.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            // ãƒªã‚¹ãƒˆï¼ˆé †åºãªã—ï¼‰
            processedText = processedText.replace(/^- (.+)$/gm, '<li>$1</li>');
            processedText = processedText.replace(/(<li>.*<\/li>)/s, (match) => {
                const items = match.split('\n').filter(item => item.trim());
                return '<ul>' + items.join('\n') + '</ul>';
            });
            
            // ãƒªã‚¹ãƒˆï¼ˆé †åºã‚ã‚Šï¼‰
            processedText = processedText.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
            
            // å¼•ç”¨
            processedText = processedText.replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>');
            
            // æ°´å¹³ç·š
            processedText = processedText.replace(/^---$/gm, '<hr>');
            
            // æ®µè½
            processedText = processedText.split('\n\n').map(para => {
                if (para.trim() && !para.startsWith('<')) {
                    return `<p>${para.trim()}</p>`;
                }
                return para;
            }).join('\n');
            
            // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’å¾©å…ƒ
            codeBlocks.forEach((code, index) => {
                processedText = processedText.replace(`__CODEBLOCK_${index}__`, code);
            });
            
            return processedText;
        }

        function linkifyText(text) {
            // URLãƒ‘ã‚¿ãƒ¼ãƒ³
            const urlPattern = /(https?:\/\/[^\s<]+)/g;
            // ãƒ¡ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³
            const emailPattern = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
            
            text = text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
            text = text.replace(emailPattern, '<a href="mailto:$1">$1</a>');
            
            return text;
        }

        // ===== ç´¹ä»‹å…ƒãƒªãƒ³ã‚¯ç®¡ç† =====
        function updateAllReferrerLinks() {
            for (const contact of contacts) {
                if (contact.referredBy) {
                    const referrers = contacts.filter(c => c.name === contact.referredBy && c.id !== contact.id);
                    
                    // ãƒªãƒ³ã‚¯æƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆ
                    delete contact.referredById;
                    delete contact.referredByIds;
                    
                    if (referrers.length === 1) {
                        contact.referredById = referrers[0].id;
                    } else if (referrers.length > 1) {
                        contact.referredByIds = referrers.map(r => r.id);
                    }
                }
            }
        }

        function getReferrerDisplay(contact) {
            if (contact.referredById) {
                const referrer = contacts.find(c => c.id === contact.referredById);
                if (referrer) {
                    return `<a href="#" onclick="showContactDetail('${referrer.id}'); return false;">${escapeHtml(referrer.name)}</a>`;
                }
            } else if (contact.referredByIds && contact.referredByIds.length > 0) {
                return `<span>${escapeHtml(contact.referredBy)} <small style="color: #d93025;">(ç´¹ä»‹å…ƒãŒè¤‡æ•°ã‚ã‚Šã¾ã™)</small></span>`;
            }
            return escapeHtml(contact.referredBy);
        }

        // ===== ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç† =====
        function updateDropdownOptions() {
            updateSelectOptions('filterType', dropdownOptions.types);
            updateSelectOptions('filterAffiliation', dropdownOptions.affiliations);
            updateSelectOptions('filterWantToConnect', dropdownOptions.wantToConnect);
            updateSelectOptions('filterGoldenEgg', dropdownOptions.goldenEgg);
            
            // ç´¹ä»‹å…ƒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const referrers = [...new Set(contacts.map(c => c.referredBy).filter(Boolean))];
            updateSelectOptions('filterReferredBy', referrers);
            
            // ã‚¨ãƒªã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const areas = [...new Set(contacts.map(c => c.area).filter(Boolean))];
            updateSelectOptions('filterArea', areas);
            
            // å±…ä½åœ°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const residences = [...new Set(contacts.map(c => c.residence).filter(Boolean))];
            updateSelectOptions('filterResidence', residences);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            select.innerHTML = '<option value="">ã™ã¹ã¦</option>';
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
            select.value = currentValue;
        }

        // ===== ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆ =====
        function setupMultiSelect() {
            ['types', 'affiliations', 'wantToConnect', 'goldenEgg'].forEach(field => {
                updateMultiSelectOptions(field, dropdownOptions[field]);
            });
        }

        function updateMultiSelectOptions(field, options) {
            const dropdown = document.getElementById(`${field}-dropdown`);
            const selectedValues = getSelectedValues(field);
            
            dropdown.innerHTML = options.map(option => `
                <div class="multi-select-option" onclick="toggleOption('${field}', '${escapeHtml(option)}')">
                    <input type="checkbox" ${selectedValues.includes(option) ? 'checked' : ''}>
                    <span>${escapeHtml(option)}</span>
                </div>
            `).join('') + `
                <div class="multi-select-option" onclick="addNewOption('${field}')">
                    <span style="color: #4c8bf5;">+ æ–°ã—ã„é …ç›®ã‚’è¿½åŠ </span>
                </div>
            `;
        }

        function toggleMultiSelect(field) {
            const dropdown = document.getElementById(`${field}-dropdown`);
            const allDropdowns = document.querySelectorAll('.multi-select-dropdown');
            
            allDropdowns.forEach(d => {
                if (d !== dropdown) d.classList.remove('show');
            });
            
            dropdown.classList.toggle('show');
        }

        function toggleOption(field, value) {
            const display = event.target.closest('.multi-select').querySelector('.multi-select-display');
            const checkbox = event.target.querySelector('input[type="checkbox"]');
            
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
            }
            
            updateMultiSelectDisplay(field);
        }

        function getSelectedValues(field) {
            const checkboxes = document.querySelectorAll(`#${field}-dropdown input[type="checkbox"]:checked`);
            return Array.from(checkboxes).map(cb => cb.parentElement.querySelector('span').textContent);
        }

        function setSelectedValues(field, values) {
            const checkboxes = document.querySelectorAll(`#${field}-dropdown input[type="checkbox"]`);
            checkboxes.forEach(cb => {
                const value = cb.parentElement.querySelector('span').textContent;
                cb.checked = values.includes(value);
            });
            updateMultiSelectDisplay(field);
        }

        function updateMultiSelectDisplay(field) {
            const display = document.querySelector(`#${field}-dropdown`).previousElementSibling;
            const selected = getSelectedValues(field);
            
            if (selected.length === 0) {
                display.innerHTML = '<span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>';
            } else {
                display.innerHTML = selected.map(value => 
                    `<span class="selected-tag">${escapeHtml(value)}<span class="remove" onclick="removeSelectedValue('${field}', '${escapeHtml(value)}')">&times;</span></span>`
                ).join('');
            }
        }

        function removeSelectedValue(field, value) {
            event.stopPropagation();
            const checkbox = Array.from(document.querySelectorAll(`#${field}-dropdown input[type="checkbox"]`))
                .find(cb => cb.parentElement.querySelector('span').textContent === value);
            if (checkbox) {
                checkbox.checked = false;
                updateMultiSelectDisplay(field);
            }
        }

        async function addNewOption(field) {
            event.stopPropagation();
            const newValue = prompt('æ–°ã—ã„é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (newValue && newValue.trim()) {
                const trimmedValue = newValue.trim();
                if (!dropdownOptions[field].includes(trimmedValue)) {
                    dropdownOptions[field].push(trimmedValue);
                    dropdownOptions[field].sort();
                    updateMultiSelectOptions(field, dropdownOptions[field]);
                    updateDropdownOptions();
                    await saveData();
                }
            }
        }

        // ===== ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ =====
        function resetContactForm() {
            document.getElementById('contactForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('cardImagePreview').innerHTML = '';
            document.getElementById('existingAttachments').innerHTML = '';
            document.getElementById('newAttachments').innerHTML = '';
            currentPhotoFile = null;
            currentCardImageFile = null;
            selectedFiles = [];
            deletedAttachments = [];
            
            // ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            ['types', 'affiliations', 'wantToConnect', 'goldenEgg'].forEach(field => {
                const checkboxes = document.querySelectorAll(`#${field}-dropdown input[type="checkbox"]`);
                checkboxes.forEach(cb => cb.checked = false);
                
                const display = document.querySelector(`#${field}-dropdown`).previousElementSibling;
                display.innerHTML = '<span style="color: #aaaaaa;">é¸æŠã—ã¦ãã ã•ã„</span>';
            });
            
            // åˆå›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°é–¢é€£ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedFirstMeetingFiles = [];
            document.getElementById('firstMeetingSection').style.display = 'none';
            document.getElementById('firstMeetingTaskContainer').innerHTML = '';
            document.getElementById('firstMeetingAttachments').innerHTML = '';
        }

        function resetMeetingForm() {
            document.getElementById('meetingForm').reset();
            document.getElementById('existingMeetingAttachments').innerHTML = '';
            document.getElementById('newMeetingAttachments').innerHTML = '';
            document.getElementById('taskInputContainer').innerHTML = '';
            selectedMeetingFiles = [];
            deletedMeetingAttachments = [];
            hasUnsavedDraft = false;
        }

        // ===== ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›† =====
        function showTemplateEditor() {
            const settingsList = document.querySelector('.settings-list');
            const templateEditor = document.getElementById('templateEditor');
            
            settingsList.style.display = 'none';
            templateEditor.style.display = 'block';
            
            // æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
            const savedTemplate = localStorage.getItem('meetingTemplate') || '';
            document.getElementById('templateContent').value = savedTemplate;
        }

        function hideTemplateEditor() {
            const settingsList = document.querySelector('.settings-list');
            const templateEditor = document.getElementById('templateEditor');
            
            settingsList.style.display = 'block';
            templateEditor.style.display = 'none';
        }

        function saveTemplate() {
            const templateContent = document.getElementById('templateContent').value;
            localStorage.setItem('meetingTemplate', templateContent);
            
            saveOptions();
            
            showNotification('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            hideTemplateEditor();
        }

        // ===== ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ =====
        async function exportData() {
            closeModal('settingsModal');
            
            try {
                const exportData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    contacts: contacts,
                    meetings: meetings,
                    dropdownOptions: dropdownOptions
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `meeting_data_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                showLoading();
                const text = await file.text();
                const importedData = JSON.parse(text);
                
                if (!importedData.version || !importedData.contacts || !importedData.meetings) {
                    throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                }
                
                // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã¨ãƒãƒ¼ã‚¸
                const existingContactIds = new Set(contacts.map(c => c.id));
                const existingMeetingIds = new Set(meetings.map(m => m.id));
                
                let addedContacts = 0;
                let addedMeetings = 0;
                
                // é€£çµ¡å…ˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                for (const contact of importedData.contacts) {
                    if (!existingContactIds.has(contact.id)) {
                        // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸåŒ–
                        if (!contact.hasOwnProperty('yomi')) contact.yomi = '';
                        if (!contact.hasOwnProperty('cutout')) contact.cutout = '';
                        if (!contact.hasOwnProperty('cardImage')) contact.cardImage = '';
                        if (!contact.hasOwnProperty('cardImageUrl')) contact.cardImageUrl = '';
                        
                        // é¡”å†™çœŸURLã‚’å¤‰æ›
                        if (contact.photoUrl) {
                            contact.photoUrl = toDirectLink(contact.photoUrl);
                        }
                        
                        contacts.push(contact);
                        addedContacts++;
                    }
                }
                
                // ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                for (const meeting of importedData.meetings) {
                    if (!existingMeetingIds.has(meeting.id)) {
                        // é–¢é€£ã™ã‚‹é€£çµ¡å…ˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
                        if (contacts.some(c => c.id === meeting.contactId)) {
                            meetings.push(meeting);
                            addedMeetings++;
                        }
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ
                migrateMeetingsData();
                migrateContactsData();
                migratePhotoUrls();
                
                // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒãƒ¼ã‚¸
                if (importedData.dropdownOptions) {
                    for (const key in importedData.dropdownOptions) {
                        if (dropdownOptions[key]) {
                            dropdownOptions[key] = [...new Set([...dropdownOptions[key], ...importedData.dropdownOptions[key]])];
                        }
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                await saveData();
                
                // UIã‚’æ›´æ–°
                updateDropdownOptions();
                updateAllReferrerLinks();
                renderContactList();
                
                hideLoading();
                showNotification(`ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†: ${addedContacts}ä»¶ã®é€£çµ¡å…ˆã¨${addedMeetings}ä»¶ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
                
                // ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
                event.target.value = '';
            } catch (error) {
                console.error('Import error:', error);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                hideLoading();
                event.target.value = '';
            }
        }

        // ===== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ =====
        document.addEventListener('DOMContentLoaded', () => {
            setupFileDragDrop();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });
            
            // ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆã‚’é–‰ã˜ã‚‹
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.multi-select')) {
                    document.querySelectorAll('.multi-select-dropdown').forEach(dropdown => {
                        dropdown.classList.remove('show');
                    });
                }
            });
            
            // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼ã‚’é˜²æ­¢
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            
            document.addEventListener('drop', (e) => {
                e.preventDefault();
            });
            
            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®ç›£è¦–
            window.addEventListener('online', () => {
                showNotification('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¾©æ—§ã—ã¾ã—ãŸ', 'success');
            });
            
            window.addEventListener('offline', () => {
                showNotification('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸ', 'error');
            });
        });

        window.onbeforeunload = function(e) {
            // æœªä¿å­˜ã®ãƒ‰ãƒ©ãƒ•ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿è­¦å‘Šã‚’è¡¨ç¤º
            if (hasUnsavedDraft) {
                const message = 'ç·¨é›†ä¸­ã®å†…å®¹ãŒã‚ã‚Šã¾ã™ã€‚ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ';
                e.returnValue = message;
                return message;
            }
        };

        // ===== åˆæœŸåŒ– =====
        window.onload = function() {
            // ã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–ï¼ˆCLIENT_IDã®ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼‰
            initializeApp();
        };

        function handleCredentialResponse(response) {
            // ID token ã‚’å‡¦ç†ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
            console.log("ID token received");
        }
    </script>
</body>
</html>