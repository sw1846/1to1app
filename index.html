<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1ÂØæ1„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†ÔºàGoogle„Éâ„É©„Ç§„ÉñÁâàÔºâ</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="favicon.ico">
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="header-content">
            <h1>1ÂØæ1„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
            <div class="header-actions">
                <!-- GoogleË™çË®º„Éú„Çø„É≥ -->
                <button class="btn btn-success" id="googleSignInBtn" onclick="handleAuthClick()">
                    üîê Google„Åß„É≠„Ç∞„Ç§„É≥
                </button>
                <button class="btn btn-danger" id="signoutBtn" style="display: none;" onclick="handleSignoutClick()">
                    üö™ „É≠„Ç∞„Ç¢„Ç¶„Éà
                </button>
                
                <!-- [CLAUDE FIX ALL-IN-ONE][darkmode] „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà„Éú„Çø„É≥ -->
                <button class="btn btn-icon" id="themeToggle" title="„ÉÜ„Éº„ÉûÂàáÊõø">
                    <span id="themeIcon">üåô</span>
                </button>
                <!-- [CLAUDE FIX ALL-IN-ONE][merge-button] „Éá„Éº„Çø„Éû„Éº„Ç∏„Éú„Çø„É≥„ÇíÂâäÈô§Ôºà„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„ÉàÔºâ -->
                <!-- <button class="btn btn-secondary" id="dataMergeBtn" onclick="mergeData()">„Éá„Éº„Çø„Éû„Éº„Ç∏</button> -->
            </div>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ -->
            <div id="statusText" class="status-text">Google„Åß„Çµ„Ç§„É≥„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            
            <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
            <div class="tabs" id="mainTabs" style="display: none;">
                <button class="tab active" id="contactsTab" onclick="showContactsView()">ÈÄ£Áµ°ÂÖà</button>
                <button class="tab" id="meetingsTab" onclick="showMeetingsView()">„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞</button>
            </div>

            <!-- ÈÄ£Áµ°ÂÖà„Éì„É•„Éº -->
            <div class="view" id="contactsView" style="display: none;">
                <!-- Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Éº -->
                <div class="search-filters">
                    <div class="search-section">
                        <input type="text" id="searchInput" class="search-input" placeholder="ÈÄ£Áµ°ÂÖà„ÇíÊ§úÁ¥¢..." />
                    </div>
                    
                    <!-- [CLAUDE FIX ALL-IN-ONE][filter] „Éï„Ç£„É´„Çø„ÉºÊîπ‰øÆ -->
                    <div class="filters-section">
                        <div class="filter-group">
                            <label for="typeFilter">Á®ÆÂà•</label>
                            <select id="typeFilter" class="filter-select">
                                <option value="">„Åô„Åπ„Å¶</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="affiliationFilter">ÊâÄÂ±û</label>
                            <select id="affiliationFilter" class="filter-select">
                                <option value="">„Åô„Åπ„Å¶</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="businessFilter">‰∫ãÊ•≠</label>
                            <select id="businessFilter" class="filter-select">
                                <option value="">„Åô„Åπ„Å¶</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="residenceFilter">Â±Ö‰ΩèÂú∞</label>
                            <select id="residenceFilter" class="filter-select">
                                <option value="">„Åô„Åπ„Å¶</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ÈÄ£Áµ°ÂÖà‰∏ÄË¶ß -->
                <div class="contacts-section">
                    <div class="section-header">
                        <h2>ÈÄ£Áµ°ÂÖà‰∏ÄË¶ß</h2>
                        <button class="btn btn-primary" onclick="showNewContactModal()">+ Êñ∞Ë¶èÈÄ£Áµ°ÂÖà</button>
                    </div>
                    <div id="contactsContainer" class="contacts-container">
                        <div class="loading">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
            </div>

            <!-- „Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Éì„É•„Éº -->
            <div class="view" id="meetingsView" style="display: none;">
                <div class="meetings-section">
                    <div class="section-header">
                        <h2>„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞‰∏ÄË¶ß</h2>
                        <button class="btn btn-primary" onclick="showNewMeetingModal()">+ Êñ∞Ë¶è„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞</button>
                    </div>
                    <div id="meetingsContainer" class="meetings-container">
                        <div class="loading">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ÈÄ£Áµ°ÂÖàË©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="contactDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÈÄ£Áµ°ÂÖàË©≥Á¥∞</h3>
                <button class="modal-close" onclick="closeModal('contactDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('contactDetailModal')">Èñâ„Åò„Çã</button>
                <button class="btn btn-primary" onclick="editCurrentContact()">Á∑®ÈõÜ</button>
            </div>
        </div>
    </div>

    <!-- ÈÄ£Áµ°ÂÖàÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="contactEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÈÄ£Áµ°ÂÖàÁ∑®ÈõÜ</h3>
                <button class="modal-close" onclick="closeModal('contactEditModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contactEditForm">
                    <div class="form-group">
                        <label for="contactName">ÂêçÂâç *</label>
                        <input type="text" id="contactName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="contactFurigana">„Åµ„Çä„Åå„Å™</label>
                        <input type="text" id="contactFurigana" name="furigana">
                    </div>
                    <div class="form-group">
                        <label for="contactCompany">‰ºöÁ§æ„ÉªÁµÑÁπî</label>
                        <input type="text" id="contactCompany" name="company">
                    </div>
                    
                    <!-- [CLAUDE FIX ALL-IN-ONE][options] „Éû„É´„ÉÅ„Çª„É¨„ÇØ„ÉàÂØæÂøú -->
                    <div class="form-group">
                        <label for="contactTypes">Á®ÆÂà•</label>
                        <div class="multi-select-wrapper">
                            <div class="multi-select-display" onclick="toggleMultiSelectDropdown('contactTypes')">
                                <span class="selected-items" id="contactTypesDisplay">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="multi-select-dropdown" id="contactTypesDropdown" style="display: none;">
                                <select id="contactTypes" name="types" multiple>
                                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactAffiliations">ÊâÄÂ±û</label>
                        <div class="multi-select-wrapper">
                            <div class="multi-select-display" onclick="toggleMultiSelectDropdown('contactAffiliations')">
                                <span class="selected-items" id="contactAffiliationsDisplay">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="multi-select-dropdown" id="contactAffiliationsDropdown" style="display: none;">
                                <select id="contactAffiliations" name="affiliations" multiple>
                                    <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactBusiness">‰∫ãÊ•≠ÂÜÖÂÆπ</label>
                        <select id="contactBusiness" name="business">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactResidence">Â±Ö‰ΩèÂú∞</label>
                        <select id="contactResidence" name="residence">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactEmail">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                        <input type="email" id="contactEmail" name="email">
                    </div>
                    
                    <div class="form-group">
                        <label for="contactPhone">ÈõªË©±Áï™Âè∑</label>
                        <input type="tel" id="contactPhone" name="phone">
                    </div>
                    
                    <div class="form-group">
                        <label for="contactNotes">„É°„É¢</label>
                        <textarea id="contactNotes" name="notes" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('contactEditModal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn-primary" onclick="saveContactForm()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- „Éü„Éº„ÉÜ„Ç£„É≥„Ç∞Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="meetingDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞Ë©≥Á¥∞</h3>
                <button class="modal-close" onclick="closeModal('meetingDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('meetingDetailModal')">Èñâ„Åò„Çã</button>
                <button class="btn btn-primary" onclick="editCurrentMeeting()">Á∑®ÈõÜ</button>
            </div>
        </div>
    </div>

    <!-- „Éü„Éº„ÉÜ„Ç£„É≥„Ç∞Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="meetingEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞Á∑®ÈõÜ</h3>
                <button class="modal-close" onclick="closeModal('meetingEditModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="meetingEditForm">
                    <div class="form-group">
                        <label for="meetingTitle">„Çø„Ç§„Éà„É´ *</label>
                        <input type="text" id="meetingTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="meetingContact">ÈÄ£Áµ°ÂÖà *</label>
                        <select id="meetingContact" name="contactId" required>
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="meetingDate">Êó•‰ªò</label>
                            <input type="date" id="meetingDate" name="date">
                        </div>
                        <div class="form-group">
                            <label for="meetingTime">ÊôÇÂàª</label>
                            <input type="time" id="meetingTime" name="time">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="meetingLocation">Â†¥ÊâÄ</label>
                        <input type="text" id="meetingLocation" name="location">
                    </div>
                    <div class="form-group">
                        <label for="meetingContent">ÂÜÖÂÆπ</label>
                        <textarea id="meetingContent" name="content" rows="6" placeholder="„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('meetingEditModal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn-primary" onclick="saveMeetingForm()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- ÁîªÂÉèË°®Á§∫„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-modal">
            <div class="modal-header">
                <h3 class="modal-title">ÁîªÂÉèË°®Á§∫</h3>
                <button class="modal-close" onclick="closeModal('imageModal')">&times;</button>
            </div>
            <div class="modal-body">
                <img id="modalImage" class="modal-image" alt="Ë°®Á§∫ÁîªÂÉè">
            </div>
        </div>
    </div>

    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Ë™≠„ÅøËæº„Åø‰∏≠...</p>
        </div>
    </div>

    <!-- ÈÄöÁü•„Ç®„É™„Ç¢ -->
    <div id="notificationArea" class="notification-area"></div>

    <!-- JavaScript„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data.20250925u.js"></script>
    <script src="js/contacts.js"></script>
    <script src="js/meetings.js"></script>
    <script src="js/main.js"></script>
    
    <!-- [CLAUDE FIX ALL-IN-ONE] „É¢„Éº„ÉÄ„É´„Éª„Éï„Ç©„Éº„É†Èñ¢ÈÄ£„ÅÆ„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞ -->
    <script>
        // „É¢„Éº„ÉÄ„É´Âà∂Âæ°
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Êñ∞Ë¶èÈÄ£Áµ°ÂÖà„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showNewContactModal() {
            const modal = document.getElementById('contactEditModal');
            if (modal) {
                // „Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
                document.getElementById('contactEditForm').reset();
                
                // „Ç™„Éó„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
                if (window.updateEditFormOptions) {
                    window.updateEditFormOptions();
                }
                
                modal.style.display = 'block';
                window.currentContactId = null; // Êñ∞Ë¶è‰ΩúÊàê„Éï„É©„Ç∞
            }
        }

        // ÈÄ£Áµ°ÂÖàÁ∑®ÈõÜ
        function editCurrentContact() {
            if (window.currentContactId) {
                closeModal('contactDetailModal');
                if (window.editContact) {
                    window.editContact(window.currentContactId);
                }
            }
        }

        // ÈÄ£Áµ°ÂÖà„Éï„Ç©„Éº„É†‰øùÂ≠ò
        function saveContactForm() {
            try {
                const form = document.getElementById('contactEditForm');
                const formData = new FormData(form);
                
                const contact = {
                    id: window.currentContactId || generateUUID(),
                    name: formData.get('name'),
                    furigana: formData.get('furigana'),
                    company: formData.get('company'),
                    business: formData.get('business'),
                    residence: formData.get('residence'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    notes: formData.get('notes'),
                    types: getMultiSelectValues('contactTypes'),
                    affiliations: getMultiSelectValues('contactAffiliations'),
                    createdAt: window.currentContactId ? undefined : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // ÂøÖÈ†à„Éï„Ç£„Éº„É´„Éâ„ÉÅ„Çß„ÉÉ„ÇØ
                if (!contact.name.trim()) {
                    showNotification('ÂêçÂâç„ÅØÂøÖÈ†à„Åß„Åô', 'warning');
                    return;
                }

                if (window.saveContact) {
                    window.saveContact(contact).then(() => {
                        closeModal('contactEditModal');
                        showNotification('ÈÄ£Áµ°ÂÖà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
                    }).catch(e => {
                        showNotification('‰øùÂ≠ò„Ç®„É©„Éº: ' + e.message, 'error');
                    });
                }
            } catch (e) {
                console.error('saveContactForm error:', e);
                showNotification('‰øùÂ≠ò„Ç®„É©„Éº: ' + e.message, 'error');
            }
        }

        // „Éû„É´„ÉÅ„Çª„É¨„ÇØ„ÉàÂÄ§ÂèñÂæó
        function getMultiSelectValues(selectId) {
            const select = document.getElementById(selectId);
            if (select && select.multiple) {
                return Array.from(select.selectedOptions).map(option => option.value);
            }
            return [];
        }

        // Êñ∞Ë¶è„Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showNewMeetingModal() {
            if (window.createNewMeeting) {
                window.createNewMeeting();
            }
        }

        // „Éü„Éº„ÉÜ„Ç£„É≥„Ç∞Á∑®ÈõÜ
        function editCurrentMeeting() {
            if (window.currentMeetingId && window.showMeetingEditModal) {
                const meeting = (window.meetings || []).find(m => m.id === window.currentMeetingId);
                if (meeting) {
                    closeModal('meetingDetailModal');
                    window.showMeetingEditModal(meeting);
                }
            }
        }

        // „Éü„Éº„ÉÜ„Ç£„É≥„Ç∞„Éï„Ç©„Éº„É†‰øùÂ≠ò
        function saveMeetingForm() {
            if (window.saveMeeting) {
                window.saveMeeting();
            }
        }

        // ÁîªÂÉèË°®Á§∫„É¢„Éº„ÉÄ„É´
        function showImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            if (modal && modalImage) {
                modalImage.src = imageSrc;
                modal.style.display = 'block';
            }
        }

        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>