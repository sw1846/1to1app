<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1対1ミーティング管理システム</title>
    <meta name="description" content="Google Driveと連携した1対1ミーティング管理システム">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ログイン画面 -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h2>1対1ミーティング管理システム</h2>
            <p>Googleアカウントでログインして開始</p>
            <button id="loginBtn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                Googleでログイン
            </button>
        </div>
    </div>

    <!-- メインアプリ -->
    <div id="app">
        <header>
            <div class="header-content">
                <h1>1対1ミーティング管理システム</h1>
                <div>
                    <button id="syncBtn" class="btn-secondary">
                        <span>🔄</span> 同期
                    </button>
                    <button id="importExportBtn" class="btn-secondary">
                        <span>📥</span> インポート/エクスポート
                    </button>
                    <button id="logoutBtn" class="btn-secondary">
                        <span>🚪</span> ログアウト
                    </button>
                </div>
            </div>
        </header>

        <main>
            <!-- ナビゲーションタブ -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="contacts">連絡先</button>
                <button class="nav-tab" data-tab="meetings">ミーティング記録</button>
                <button class="nav-tab" data-tab="settings">設定</button>
            </div>

            <!-- 連絡先タブ -->
            <div id="contactsTab" class="tab-content">
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="名前・会社名で検索...">
                    </div>
                    <select id="filterType">
                        <option value="">種別でフィルター</option>
                    </select>
                    <select id="filterAffiliation">
                        <option value="">所属でフィルター</option>
                    </select>
                    <button id="addContactBtn">
                        <span>➕</span> 新規連絡先
                    </button>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="card" title="カードビュー">📇</button>
                        <button class="view-btn" data-view="list" title="リストビュー">📋</button>
                    </div>
                </div>

                <div id="contactsList" class="contacts-grid">
                    <!-- 連絡先カードがここに動的に表示される -->
                </div>
            </div>

            <!-- ミーティング記録タブ -->
            <div id="meetingsTab" class="tab-content" style="display: none;">
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" id="meetingSearchInput" placeholder="ミーティング内容を検索...">
                    </div>
                    <select id="meetingContactFilter">
                        <option value="">全ての連絡先</option>
                    </select>
                    <button id="addMeetingBtn">
                        <span>➕</span> 新規ミーティング
                    </button>
                </div>

                <div id="meetingsList">
                    <!-- ミーティング記録がここに動的に表示される -->
                </div>
            </div>

            <!-- 設定タブ -->
            <div id="settingsTab" class="tab-content" style="display: none;">
                <h2>設定</h2>
                <div class="form-group">
                    <label>ミーティング記録テンプレート</label>
                    <textarea id="meetingTemplate" rows="5" placeholder="ミーティング記録の初期テンプレート

例：
1. 近況報告
2. 相談事項
3. 次回までのアクション"></textarea>
                </div>
                <button id="saveSettingsBtn">
                    <span>💾</span> 設定を保存
                </button>
            </div>
        </main>
    </div>

    <!-- 連絡先フォームモーダル -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">新規連絡先</h2>
                <button class="close-btn" onclick="closeContactModal()">&times;</button>
            </div>
            <form id="contactForm">
                <div class="form-group">
                    <label>顔写真</label>
                    <div class="file-upload" id="photoUpload">
                        <p>📷 クリックまたはドラッグ＆ドロップ</p>
                        <input type="file" id="photoInput" accept="image/*">
                    </div>
                    <div id="photoPreview" class="contact-photo" style="margin-top: 1rem; display: none;">
                        <img id="photoImg" src="" alt="">
                    </div>
                </div>

                <div class="form-group">
                    <label>氏名 *</label>
                    <input type="text" id="name" required>
                </div>

                <div class="form-group">
                    <label>ふりがな</label>
                    <input type="text" id="yomi">
                </div>

                <div class="form-group">
                    <label>会社名</label>
                    <input type="text" id="company">
                </div>

                <div class="form-group">
                    <label>メールアドレス</label>
                    <input type="email" id="email">
                </div>

                <div class="form-group">
                    <label>電話番号</label>
                    <input type="tel" id="phone">
                </div>

                <div class="form-group">
                    <label>ホームページ</label>
                    <input type="url" id="homepage">
                </div>

                <div class="form-group">
                    <label>紹介者</label>
                    <input type="text" id="referredBy" list="referredByList">
                    <datalist id="referredByList"></datalist>
                </div>

                <div class="form-group">
                    <label>活動エリア</label>
                    <input type="text" id="area" list="areaList">
                    <datalist id="areaList"></datalist>
                </div>

                <div class="form-group">
                    <label>居住地</label>
                    <input type="text" id="residence" list="residenceList">
                    <datalist id="residenceList"></datalist>
                </div>

                <div class="form-group">
                    <label>種別</label>
                    <div class="checkbox-group" id="typesGroup">
                        <!-- チェックボックスが動的に生成される -->
                    </div>
                </div>

                <div class="form-group">
                    <label>所属・チャプター</label>
                    <div class="checkbox-group" id="affiliationsGroup">
                        <!-- チェックボックスが動的に生成される -->
                    </div>
                </div>

                <div class="form-group">
                    <label>繋がりたい人・業種</label>
                    <div class="checkbox-group" id="wantToConnectGroup">
                        <!-- チェックボックスが動的に生成される -->
                    </div>
                </div>

                <div class="form-group">
                    <label>金の卵</label>
                    <div class="checkbox-group" id="goldenEggGroup">
                        <!-- チェックボックスが動的に生成される -->
                    </div>
                </div>

                <div class="form-group">
                    <label>強み</label>
                    <textarea id="strengths" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>過去の経歴</label>
                    <textarea id="careerHistory" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>印象的な一言</label>
                    <input type="text" id="cutout">
                </div>

                <div class="form-group">
                    <label>名刺画像</label>
                    <div class="file-upload" id="businessCardUpload">
                        <p>🎴 クリックまたはドラッグ＆ドロップ</p>
                        <input type="file" id="businessCardInput" accept="image/*">
                    </div>
                </div>

                <div class="form-group">
                    <label>添付ファイル</label>
                    <div class="file-upload" id="attachmentsUpload">
                        <p>📎 複数ファイル可（クリックまたはドラッグ＆ドロップ）</p>
                        <input type="file" id="attachmentsInput" multiple>
                    </div>
                    <div id="attachmentsList" style="margin-top: 1rem;"></div>
                </div>

                <!-- 初回ミーティング記録（新規作成時のみ） -->
                <div id="initialMeetingSection" style="display: none;">
                    <h3 style="margin: 2rem 0 1rem;">初回ミーティング記録</h3>
                    <div class="form-group">
                        <label>日時</label>
                        <input type="datetime-local" id="initialMeetingDate">
                    </div>
                    <div class="form-group">
                        <label>内容</label>
                        <textarea id="initialMeetingContent" rows="5"></textarea>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn-secondary" onclick="closeContactModal()">キャンセル</button>
                    <button type="submit">
                        <span>💾</span> 保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ミーティングフォームモーダル -->
    <div id="meetingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ミーティング記録</h2>
                <button class="close-btn" onclick="closeMeetingModal()">&times;</button>
            </div>
            <form id="meetingForm">
                <div class="form-group">
                    <label>連絡先 *</label>
                    <select id="meetingContactId" required>
                        <option value="">選択してください</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>日時 *</label>
                    <input type="datetime-local" id="meetingDate" required>
                </div>

                <div class="form-group">
                    <label>内容 *</label>
                    <textarea id="meetingContent" rows="5" required></textarea>
                </div>

                <div class="form-group">
                    <label>ToDo</label>
                    <div id="todoList">
                        <!-- ToDoアイテムが動的に追加される -->
                    </div>
                    <button type="button" class="btn-secondary" onclick="addTodo()">
                        <span>➕</span> ToDoを追加
                    </button>
                </div>

                <div class="form-group">
                    <label>添付ファイル</label>
                    <div class="file-upload" id="meetingAttachmentsUpload">
                        <p>📎 複数ファイル可（クリックまたはドラッグ＆ドロップ）</p>
                        <input type="file" id="meetingAttachmentsInput" multiple>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn-secondary" onclick="closeMeetingModal()">キャンセル</button>
                    <button type="submit">
                        <span>💾</span> 保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- インポート/エクスポートモーダル -->
    <div id="importExportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>インポート/エクスポート</h2>
                <button class="close-btn" onclick="closeImportExportModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <h3>📤 エクスポート</h3>
                <p>すべてのデータをJSON形式でダウンロードします。</p>
                <button onclick="exportData()">
                    <span>💾</span> データをエクスポート
                </button>
            </div>

            <div class="form-group" style="margin-top: 2rem;">
                <h3>📥 インポート</h3>
                <p>JSON形式のデータファイルを選択してください。</p>
                <div class="file-upload" id="importUpload">
                    <p>📁 クリックまたはドラッグ＆ドロップ</p>
                    <input type="file" id="importInput" accept=".json">
                </div>
            </div>
        </div>
    </div>

    <!-- ローディングオーバーレイ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Google API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    
    <!-- アプリケーションスクリプト -->
    <script src="auth.js"></script>
    <script src="storage.js"></script>
    <script src="contacts.js"></script>
    <script src="meetings.js"></script>
    <script src="ui.js"></script>
    <script src="app.js"></script>
</body>
</html>